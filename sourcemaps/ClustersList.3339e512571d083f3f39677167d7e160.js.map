{"version":3,"file":"js/ClustersList.c13c7853a1b39473d606.js","mappings":"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","sources":["webpack:///./src/Components/ClustersListTable/ClustersListTable.js","webpack:///./src/Components/ClustersListTable/index.js","webpack:///./src/Components/ClustersList/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useIntl } from 'react-intl';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport {\n  SortByDirection,\n  Table,\n  TableBody,\n  TableHeader,\n  TableVariant,\n} from '@patternfly/react-table';\nimport { Card, CardBody } from '@patternfly/react-core/dist/js/components/Card';\nimport { Bullseye } from '@patternfly/react-core/dist/js/layouts/Bullseye';\nimport { Spinner } from '@patternfly/react-core/dist/js/components/Spinner';\nimport {\n  Pagination,\n  PaginationVariant,\n} from '@patternfly/react-core/dist/js/components/Pagination';\nimport PrimaryToolbar from '@redhat-cloud-services/frontend-components/PrimaryToolbar/PrimaryToolbar';\n\nimport {\n  CLUSTERS_LIST_INITIAL_STATE,\n  updateClustersListFilters,\n} from '../../Services/Filters';\nimport {\n  CLUSTERS_LIST_COLUMNS,\n  CLUSTER_FILTER_CATEGORIES,\n  CLUSTER_LAST_CHECKED_CELL,\n  CLUSTER_NAME_CELL,\n} from '../../AppConstants';\nimport {\n  buildFilterChips,\n  mapClustersToRows,\n  passFiltersCluster,\n} from '../Common/Tables';\nimport Loading from '../Loading/Loading';\nimport messages from '../../Messages';\nimport {\n  ErrorState,\n  NoMatchingClusters,\n  NoRecsForClusters,\n} from '../MessageState/EmptyStates';\n\nconst ClustersListTable = ({\n  query: { isError, isUninitialized, isFetching, isSuccess, data },\n}) => {\n  const intl = useIntl();\n  const dispatch = useDispatch();\n  const updateFilters = (payload) =>\n    dispatch(updateClustersListFilters(payload));\n  const filters = useSelector(({ filters }) => filters.clustersListState);\n\n  const clusters = data?.data || [];\n  const page = filters.offset / filters.limit + 1;\n\n  const [filteredRows, setFilteredRows] = useState([]);\n  const [displayedRows, setDisplayedRows] = useState([]);\n\n  useEffect(() => {\n    setDisplayedRows(\n      buildDisplayedRows(filteredRows, filters.sortIndex, filters.sortDirection)\n    );\n  }, [\n    filteredRows,\n    filters.sortIndex,\n    filters.sortDirection,\n    filters.limit,\n    filters.offset,\n  ]);\n\n  useEffect(() => {\n    setFilteredRows(buildFilteredRows(clusters, filters));\n  }, [data, filters.hits, filters.text]);\n\n  const buildFilteredRows = (allRows, filters) =>\n    mapClustersToRows(\n      allRows.filter((cluster) => passFiltersCluster(cluster, filters))\n    );\n\n  const buildDisplayedRows = (rows, index, direction) => {\n    const sorted = [...rows];\n    index !== -1 &&\n      sorted.sort((a, b) => {\n        let fst, snd;\n        const d = direction === SortByDirection.asc ? 1 : -1;\n        switch (index) {\n          case CLUSTER_NAME_CELL:\n            fst = a.cluster.cluster_name || a.cluster.cluster_id;\n            snd = b.cluster.cluster_name || b.cluster.cluster_id;\n            return fst.localeCompare(snd) ? fst.localeCompare(snd) * d : 0;\n          case CLUSTER_LAST_CHECKED_CELL:\n            fst = new Date(a.cluster.last_checked_at || 0);\n            snd = new Date(b.cluster.last_checked_at || 0);\n            return fst > snd ? d : snd > fst ? -d : 0;\n          default:\n            fst = a.cells[index];\n            snd = b.cells[index];\n            return fst > snd ? d : snd > fst ? -d : 0;\n        }\n      });\n    return sorted.slice(\n      filters.limit * (page - 1),\n      filters.limit * (page - 1) + filters.limit\n    );\n  };\n\n  const removeFilterParam = (param) => {\n    const { [param]: omitted, ...newFilters } = { ...filters, offset: 0 };\n    updateFilters({\n      ...newFilters,\n      ...(param === 'text'\n        ? { text: '' }\n        : param === 'hits'\n        ? { hits: [] }\n        : {}),\n    });\n  };\n\n  // TODO: update URL when filters changed\n  const addFilterParam = (param, values) => {\n    values.length > 0\n      ? updateFilters({ ...filters, offset: 0, ...{ [param]: values } })\n      : removeFilterParam(param);\n  };\n\n  const filterConfigItems = [\n    {\n      label: intl.formatMessage(messages.name).toLowerCase(),\n      filterValues: {\n        key: 'text-filter',\n        onChange: (_event, value) => updateFilters({ ...filters, text: value }),\n        value: filters.text,\n        placeholder: intl.formatMessage(messages.filterBy),\n      },\n    },\n    {\n      label: CLUSTER_FILTER_CATEGORIES.hits.title,\n      type: CLUSTER_FILTER_CATEGORIES.hits.type,\n      id: CLUSTER_FILTER_CATEGORIES.hits.urlParam,\n      value: `checkbox-${CLUSTER_FILTER_CATEGORIES.hits.urlParam}`,\n      filterValues: {\n        key: `${CLUSTER_FILTER_CATEGORIES.hits.urlParam}-filter`,\n        onChange: (_event, values) =>\n          addFilterParam(CLUSTER_FILTER_CATEGORIES.hits.urlParam, values),\n        value: filters.hits,\n        items: CLUSTER_FILTER_CATEGORIES.hits.values,\n      },\n    },\n  ];\n\n  const activeFiltersConfig = {\n    deleteTitle: intl.formatMessage(messages.resetFilters),\n    filters: buildFilterChips(filters, CLUSTER_FILTER_CATEGORIES),\n    onDelete: (_event, itemsToRemove, isAll) => {\n      if (isAll) {\n        updateFilters(CLUSTERS_LIST_INITIAL_STATE);\n      } else {\n        itemsToRemove.map((item) => {\n          const newFilter = {\n            [item.urlParam]: Array.isArray(filters[item.urlParam])\n              ? filters[item.urlParam].filter(\n                  (value) => String(value) !== String(item.chips[0].value)\n                )\n              : '',\n          };\n          newFilter[item.urlParam].length > 0\n            ? updateFilters({ ...filters, ...newFilter })\n            : removeFilterParam(item.urlParam);\n        });\n      }\n    },\n  };\n\n  const onSort = (_e, index, direction) => {\n    updateFilters({ ...filters, sortIndex: index, sortDirection: direction });\n  };\n\n  return (\n    <>\n      {isUninitialized || isFetching ? (\n        <Bullseye>\n          <Spinner />\n        </Bullseye>\n      ) : clusters.length === 0 ? (\n        <NoRecsForClusters />\n      ) : (\n        <div id=\"clusters-list-table\">\n          <PrimaryToolbar\n            pagination={{\n              itemCount: filteredRows.length,\n              page,\n              perPage: filters.limit,\n              onSetPage: (_event, page) =>\n                updateFilters({\n                  ...filters,\n                  offset: filters.limit * (page - 1),\n                }),\n              onPerPageSelect: (_event, perPage) =>\n                updateFilters({ ...filters, limit: perPage, offset: 0 }),\n              isCompact: true,\n              ouiaId: 'pager',\n            }}\n            filterConfig={{ items: filterConfigItems }}\n            activeFiltersConfig={activeFiltersConfig}\n          />\n          {(isUninitialized || isFetching) && <Loading />}\n          {isError && (\n            <Card ouiaId=\"error-state\">\n              <CardBody>\n                <ErrorState />\n              </CardBody>\n            </Card>\n          )}\n          {!(isUninitialized || isFetching) && isSuccess && (\n            <React.Fragment>\n              <Table\n                aria-label=\"Table of clusters\"\n                ouiaId=\"clusters\"\n                variant={TableVariant.compact}\n                cells={CLUSTERS_LIST_COLUMNS}\n                rows={displayedRows}\n                sortBy={{\n                  index: filters.sortIndex,\n                  direction: filters.sortDirection,\n                }}\n                onSort={onSort}\n                isStickyHeader\n              >\n                <TableHeader />\n                <TableBody />\n              </Table>\n              {filteredRows.length === 0 && (\n                <Card ouiaId=\"empty-state\">\n                  <CardBody>\n                    <NoMatchingClusters />\n                  </CardBody>\n                </Card>\n              )}\n            </React.Fragment>\n          )}\n          <Pagination\n            ouiaId=\"pager\"\n            itemCount={filteredRows.length}\n            page={filters.offset / filters.limit + 1}\n            perPage={Number(filters.limit)}\n            onSetPage={(_e, page) =>\n              updateFilters({\n                ...filters,\n                offset: filters.limit * (page - 1),\n              })\n            }\n            onPerPageSelect={(_e, perPage) =>\n              updateFilters({ ...filters, limit: perPage, offset: 0 })\n            }\n            widgetId={`pagination-options-menu-bottom`}\n            variant={PaginationVariant.bottom}\n          />\n        </div>\n      )}\n    </>\n  );\n};\n\nClustersListTable.propTypes = {\n  query: PropTypes.object.isRequired,\n};\n\nexport { ClustersListTable };\n","import React from 'react';\nimport { useGetClustersQuery } from '../../Services/SmartProxy';\nimport { ClustersListTable } from './ClustersListTable';\n\nconst ClustersListTableWrapper = () => {\n  const query = useGetClustersQuery();\n\n  return <ClustersListTable query={query} />;\n};\n\nexport default ClustersListTableWrapper;\n","import React from 'react';\nimport { useIntl } from 'react-intl';\n\nimport PageHeader, {\n  PageHeaderTitle,\n} from '@redhat-cloud-services/frontend-components/PageHeader';\nimport Main from '@redhat-cloud-services/frontend-components/Main';\n\nimport messages from '../../Messages';\nimport ClustersListTable from '../ClustersListTable';\n\nconst ClustersList = () => {\n  const intl = useIntl();\n  document.title = intl.formatMessage(messages.documentTitle, {\n    subnav: 'Clusters',\n  });\n\n  return (\n    <React.Fragment>\n      <PageHeader className=\"ins-c-clusters-header\">\n        <PageHeaderTitle\n          title={`${intl.formatMessage(messages.insightsHeader)} ${intl\n            .formatMessage(messages.clusters)\n            .toLowerCase()}`}\n        />\n      </PageHeader>\n      <Main>\n        <ClustersListTable />\n      </Main>\n    </React.Fragment>\n  );\n};\n\nexport default ClustersList;\n"],"names":["ClustersListTable","query","isError","isUninitialized","isFetching","isSuccess","data","intl","useIntl","dispatch","useDispatch","updateFilters","payload","updateClustersListFilters","filters","useSelector","clustersListState","clusters","page","offset","limit","useState","filteredRows","setFilteredRows","displayedRows","setDisplayedRows","useEffect","buildDisplayedRows","sortIndex","sortDirection","buildFilteredRows","hits","text","allRows","mapClustersToRows","filter","cluster","passFiltersCluster","rows","index","direction","sorted","sort","a","b","fst","snd","d","SortByDirection","CLUSTER_NAME_CELL","cluster_name","cluster_id","localeCompare","CLUSTER_LAST_CHECKED_CELL","Date","last_checked_at","cells","slice","removeFilterParam","param","newFilters","filterConfigItems","label","formatMessage","messages","toLowerCase","filterValues","key","onChange","_event","value","placeholder","CLUSTER_FILTER_CATEGORIES","type","id","values","length","addFilterParam","items","activeFiltersConfig","deleteTitle","buildFilterChips","onDelete","itemsToRemove","isAll","CLUSTERS_LIST_INITIAL_STATE","map","item","newFilter","urlParam","Array","isArray","String","chips","Bullseye","Spinner","PrimaryToolbar","pagination","itemCount","perPage","onSetPage","onPerPageSelect","isCompact","ouiaId","filterConfig","Loading","Card","CardBody","Table","variant","TableVariant","CLUSTERS_LIST_COLUMNS","sortBy","onSort","_e","isStickyHeader","TableHeader","TableBody","Pagination","Number","widgetId","PaginationVariant","propTypes","PropTypes","useGetClustersQuery","document","title","subnav","PageHeader","className","PageHeaderTitle","Main"],"sourceRoot":""}