"use strict";(self.webpackChunkocp_advisor_frontend=self.webpackChunkocp_advisor_frontend||[]).push([[384],{49246:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ee});var a=r(93264),n=r.n(a),i=r(15861),l=r(93433),o=r(4942),c=r(29439),u=r(87757),s=r.n(u),m=r(78625),f=r(86896),p=r(16530),d=r(45697),g=r.n(d),v=r(48403),y=r.n(v),b=r(30097),k=r(56161),h=r(18246),P=r(88292),E=r(8045),Z=r(62410),W=r(78216),_=r(90111),x=r(71355),C=r(59303),S=r(30893),O=r(28672),M=r(90670),T=r(28186),D=r(52661),w=r(51014),A=r(98042),j=r(76913),I=r(73451),q=r(71094),L=r(86362),R=r(68929),V=r.n(R),B=r(42293),N=r(26407),F=r(99332),G=r(69507),H=r(63732),z=r(97529),U={security:n().createElement(F.ZP,null),service_availability:n().createElement(H.ZP,null),performance:n().createElement(G.ZP,null),fault_tolerance:n().createElement(z.ZP,null)},K=function(e){return e.filter((function(e){return Object.keys(C.kT).includes(e)}))},Q=function(e){var t=e.tags,r=(0,f.Z)();return n().createElement(N.LabelGroup,{numLabels:1,isCompact:!0},K(t).map((function(e,t){return n().createElement(B.Label,{key:t,icon:U[e],variant:"outline",color:"blue",isCompact:!0},r.formatMessage(S.Z[V()(e)]))})))};Q.propTypes={tags:g().array.isRequired};const X=Q;function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $=function(e){var t=e.query,r=(0,f.Z)(),u=(0,m.useDispatch)(),d=(0,m.useSelector)((function(e){return e.filters.recsListState})),g=t.isError,v=t.isUninitialized,R=t.isFetching,V=t.isSuccess,B=t.data,N=t.refetch,F=(null==B?void 0:B.recommendations)||[],G=d.offset/d.limit+1,H=(0,a.useState)([]),z=(0,c.Z)(H,2),U=z[0],Q=z[1],J=(0,a.useState)([]),$=(0,c.Z)(J,2),ee=$[0],te=$[1],re=(0,a.useState)(!1),ae=(0,c.Z)(re,2),ne=ae[0],ie=ae[1],le=(0,a.useState)({}),oe=(0,c.Z)(le,2),ce=oe[0],ue=oe[1],se=(0,a.useState)(!1),me=(0,c.Z)(se,2),fe=me[0],pe=me[1],de=function(e){return u((0,x.wN)(e))},ge=(0,p.useLocation)().search,ve=(0,a.useState)(!0),ye=(0,c.Z)(ve,2),be=ye[0],ke=ye[1],he=function(e){return u((0,O.Q4)(e))},Pe=(null==d?void 0:d.text)||"";(0,a.useEffect)((function(){te(We(U,d.sortIndex,d.sortDirection))}),[U,d.limit,d.offset,d.sortIndex,d.sortDirection]),(0,a.useEffect)((function(){Q(Ze(F,d))}),[B,d]),(0,a.useEffect)((function(){if(ge&&be){var e=(0,j.yG)(ge);if(e.sort){var t=(0,j.Lg)(e.sort[0]);e.sortIndex=C.Ax.indexOf(t.name),e.sortDirection=t.direction}e.offset&&(e.offset=Number(e.offset[0])),e.limit&&(e.limit=Number(e.limit[0])),e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=["".concat(e.impacting)]),he(Y(Y({},d),e))}ke(!1)}),[]);var Ee,Ze=function(e,t){return e.filter((function(e){return(0,j._F)(e,t)})).map((function(e,t){return[{isOpen:fe,rule:e,cells:[{title:n().createElement("span",{key:t},n().createElement(p.Link,{key:t,to:"/recommendations/".concat(e.rule_id)}," ",(null==e?void 0:e.description)||(null==e?void 0:e.rule_id)," "),n().createElement(M.Z,{rule:e}))},{title:null!=e&&e.publish_date?n().createElement(Z.Z,{key:t,date:e.publish_date,variant:"relative"}):r.formatMessage(S.Z.nA)},{title:n().createElement(X,{key:t,tags:e.tags})},{title:n().createElement("div",{key:t},n().createElement(E.Tooltip,{key:t,position:E.TooltipPosition.bottom,content:r.formatMessage(S.Z.rulesDetailsTotalRiskBody,{risk:C.Nq[e.total_risk]||r.formatMessage(S.Z.undefined),strong:function(e){return(0,T.fK)(e)}})},null!=e&&e.total_risk?n().createElement(W.Z,{value:e.total_risk,rest:{isCompact:!0}}):r.formatMessage(S.Z.nA)))},{title:n().createElement("div",{key:t},"".concat(void 0!==(null==e?void 0:e.impacted_clusters_count)?e.impacted_clusters_count.toLocaleString():r.formatMessage(S.Z.nA)))}]},{fullWidth:!0,cells:[{title:n().createElement("section",{className:"pf-m-light pf-l-page__main-section pf-c-page__main-section"},n().createElement(P.Stack,{hasGutter:!0},n().createElement(A.Z,{rule:Y(Y({},e),{},{impact:{impact:e.impact}}),isDetailsPage:!1})))}]}]}))},We=function(e,t,r){var a=(0,l.Z)(e).sort((function(e,r){var a=e[0].rule[C.Ax[t-1]],n=r[0].rule[C.Ax[t-1]];return 3===t?K(a)[0].localeCompare(K(n)[0]):a>n?1:n>a?-1:0}));return r===b.SortByDirection.desc&&a.reverse(),a.slice(d.limit*(G-1),d.limit*(G-1)+d.limit).flatMap((function(e,t){var r=(0,l.Z)(e);return e[1].parent=2*t,r}))},_e=function(e){var t=Y(Y({},d),{},{offset:0});delete t[e],he(Y(Y({},t),"text"===e?{text:""}:{}))},xe=function(e,t){return t.length>0?he(Y(Y({},d),{},{offset:0},(0,o.Z)({},e,t))):_e(e)},Ce=[{label:r.formatMessage(S.Z.name).toLowerCase(),filterValues:{key:"text-filter",onChange:function(e,t){return he(Y(Y({},d),{},{offset:0,text:t}))},value:Pe,placeholder:r.formatMessage(S.Z.filterBy)}},{label:C.W2.total_risk.title,type:C.W2.total_risk.type,id:C.W2.total_risk.urlParam,value:"checkbox-".concat(C.W2.total_risk.urlParam),filterValues:{key:"".concat(C.W2.total_risk.urlParam,"-filter"),onChange:function(e,t){return xe(C.W2.total_risk.urlParam,t)},value:d.total_risk,items:C.W2.total_risk.values}},{label:C.W2.impact.title,type:C.W2.impact.type,id:C.W2.impact.urlParam,value:"checkbox-".concat(C.W2.impact.urlParam),filterValues:{key:"".concat(C.W2.impact.urlParam,"-filter"),onChange:function(e,t){return xe(C.W2.impact.urlParam,t)},value:d.impact,items:C.W2.impact.values}},{label:C.W2.likelihood.title,type:C.W2.likelihood.type,id:C.W2.likelihood.urlParam,value:"checkbox-".concat(C.W2.likelihood.urlParam),filterValues:{key:"".concat(C.W2.likelihood.urlParam,"-filter"),onChange:function(e,t){return xe(C.W2.likelihood.urlParam,t)},value:d.likelihood,items:C.W2.likelihood.values}},{label:C.W2.category.title,type:C.W2.category.type,id:C.W2.category.urlParam,value:"checkbox-".concat(C.W2.category.urlParam),filterValues:{key:"".concat(C.W2.category.urlParam,"-filter"),onChange:function(e,t){return xe(C.W2.category.urlParam,t)},value:d.category,items:C.W2.category.values}},{label:C.W2.rule_status.title,type:C.W2.rule_status.type,id:C.W2.rule_status.urlParam,value:"radio-".concat(C.W2.rule_status.urlParam),filterValues:{key:"".concat(C.W2.rule_status.urlParam,"-filter"),onChange:function(e,t){return r=t,he(Y(Y({},d),{},{rule_status:r,offset:0}));var r},value:"".concat(d.rule_status),items:C.W2.rule_status.values}},{label:C.W2.impacting.title,type:C.W2.impacting.type,id:C.W2.impacting.urlParam,value:"checkbox-".concat(C.W2.impacting.urlParam),filterValues:{key:"".concat(C.W2.impacting.urlParam,"-filter"),onChange:function(e,t){return xe(C.W2.impacting.urlParam,t)},value:d.impacting,items:C.W2.impacting.values}}],Se={deleteTitle:r.formatMessage(S.Z.resetFilters),filters:(Ee=Y({},d),delete Ee.sortIndex,delete Ee.sortDirection,delete Ee.offset,delete Ee.limit,function(e,t){var r=Object.entries(e);return r.length>0?r.reduce((function(e,r){if(t[r[0]]){var a=t[r[0]],n=Array.isArray(r[1])?r[1].map((function(e){var t=a.values.find((function(t){return t.value===String(e)}));return t?{name:t.text||t.label,value:e}:{name:e,value:e}})):[{name:a.values.find((function(e){return e.value===String(r[1])})).label,value:r[1]}];return[].concat((0,l.Z)(e),[{category:y()(a.title),chips:n,urlParam:a.urlParam}])}return"text"===r[0]?[].concat((0,l.Z)(e),(0,l.Z)(r[1].length>0?[{category:"Name",chips:[{name:r[1],value:r[1]}],urlParam:r[0]}]:[])):e}),[]):[]}(Ee,C.W2)),onDelete:function(e,t,r){r?he(O.CH):t.map((function(e){var t=(0,o.Z)({},e.urlParam,Array.isArray(d[e.urlParam])?d[e.urlParam].filter((function(t){return String(t)!==String(e.chips[0].value)})):"");t[e.urlParam].length>0?he(Y(Y({},d),t)):_e(e.urlParam)}))}},Oe=function(){var e=(0,i.Z)(s().mark((function e(t){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=ee[t].rule,e.prev=1,a.disabled){e.next=7;break}ue(a),ie(!0),e.next=17;break;case 7:return e.prev=7,e.next=10,(0,q.HG)("".concat(L._n,"/v2/ack/").concat(a.rule_id,"/"));case 10:de({variant:"success",timeout:!0,dismissable:!0,title:r.formatMessage(S.Z.recSuccessfullyEnabled)}),N(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),de({variant:"danger",dismissable:!0,title:r.formatMessage(S.Z.error),description:"".concat(e.t0)});case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(1),de({variant:"danger",dismissable:!0,title:a.disabled?r.formatMessage(S.Z.rulesTableErrorEnabled):r.formatMessage(S.Z.rulesTableErrorDisabled),description:"".concat(e.t1)});case 22:case"end":return e.stop()}}),e,null,[[1,19],[7,14]])})));return function(t){return e.apply(this,arguments)}}();return n().createElement("div",{id:"recs-list-table"},ne&&n().createElement(I.Z,{handleModalToggle:ie,isModalOpen:ne,rule:ce,afterFn:N}),n().createElement(_.Z,{expandAll:{isAllExpanded:fe,onClick:function(e,t){pe(t),te(ee.map((function(e){return Y(Y({},e),{},{isOpen:t})})))}},pagination:{itemCount:U.length,page:d.offset/d.limit+1,perPage:Number(d.limit),onSetPage:function(e,t){he(Y(Y({},d),{},{offset:d.limit*(t-1)}))},onPerPageSelect:function(e,t){he(Y(Y({},d),{},{limit:t,offset:0}))},isCompact:!0,ouiaId:"pager"},filterConfig:{items:Ce},activeFiltersConfig:Se}),(v||R)&&n().createElement(D.Z,null),(g||V&&0===F.length)&&n().createElement(k.Card,{id:"error-state-message",ouiaId:"error-state"},n().createElement(k.CardBody,null,n().createElement(w.Te,null))),!(v||R)&&V&&F.length>0&&n().createElement(n().Fragment,null,n().createElement(b.Table,{"aria-label":"Table of recommendations",ouiaId:"recommendations",variant:b.TableVariant.compact,cells:C.XT,rows:ee,onCollapse:function(e,t,r){var a=(0,l.Z)(ee);a[t]=Y(Y({},a[t]),{},{isOpen:r}),te(a)},sortBy:{index:d.sortIndex,direction:d.sortDirection},onSort:function(e,t,r){return he(Y(Y({},d),{},{sortIndex:t,sortDirection:r}))},actionResolver:function(e,t){var a=t.rowIndex,n=ee[a].rule?ee[a].rule:null;return a%2==0&&n?n&&!n.disabled?[{title:r.formatMessage(S.Z.disableRule),onClick:function(e,t){return Oe(t)}}]:[{title:r.formatMessage(S.Z.enableRule),onClick:function(e,t){return Oe(t)}}]:null},isStickyHeader:!0},n().createElement(b.TableHeader,null),n().createElement(b.TableBody,null)),F.length>0&&0===U.length&&n().createElement(k.Card,{ouiaId:"empty-state"},n().createElement(k.CardBody,null,n().createElement(w.A0,null)))),n().createElement(h.Pagination,{ouiaId:"pager",itemCount:U.length,page:d.offset/d.limit+1,perPage:Number(d.limit),onSetPage:function(e,t){return he(Y(Y({},d),{},{offset:d.limit*(t-1)}))},onPerPageSelect:function(e,t){return he(Y(Y({},d),{},{limit:t,offset:0}))},widgetId:"pagination-options-menu-bottom",variant:h.PaginationVariant.bottom}))};$.propTypes={query:g().shape({isError:g().bool.isRequired,isUninitialized:g().bool.isRequired,isFetching:g().bool.isRequired,isSuccess:g().bool.isRequired,data:g().array,refetch:g().func})};const ee=function(){var e=(0,L.Bs)();return n().createElement($,{query:e})}}}]);
//# sourceMappingURL=../sourcemaps/RulesTable.a4a1eb7f2c44ab9d4f83c3f9d7c95888.js.map