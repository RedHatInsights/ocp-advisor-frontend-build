(self.webpackChunkocpAdvisor=self.webpackChunkocpAdvisor||[]).push([[6488],{57642:(e,t,a)=>{"use strict";a.d(t,{Lg:()=>g,Lv:()=>v,U1:()=>b,WL:()=>_,_:()=>h,_F:()=>u,aM:()=>f,im:()=>m,mt:()=>d,oo:()=>y,yG:()=>p});var r=a(48403),s=a.n(r),n=a(50361),i=a.n(n),l=(a(28416),a(81249)),c=a(81563),o=a(94608);const u=(e,t)=>Object.entries(t).every((([t,a])=>{switch(t){case"text":return e.description.toLowerCase().includes(a.toLowerCase());case c.W2.total_risk.urlParam:return a.includes(String(e.total_risk));case c.W2.category.urlParam:return e.tags.find((e=>a.includes(String(c.kT[e]))));case c.W2.impact.urlParam:return a.includes(String(e.impact));case c.W2.impacting.urlParam:return!(a.length>0)||a.some((t=>"true"===t?e.impacted_clusters_count>0:"false"===t?0===e.impacted_clusters_count:void 0));case c.W2.likelihood.urlParam:return a.includes(String(e.likelihood));case c.W2.rule_status.urlParam:return"all"===a||"disabled"===a&&e.disabled||"enabled"===a&&!e.disabled;case c.W2.res_risk.urlParam:return a.includes(String(e.resolution_risk));default:return!0}})),m=(e,t)=>Object.entries(t).every((([t,a])=>{switch(t){case"text":return(e.cluster_name||e.cluster_id).toLowerCase().includes(a.toLowerCase());case c.RT.hits.urlParam:return 0===a.length&&parseInt(e.total_hit_count)>0||a.includes("all")||a.some((t=>e.hits_by_total_risk[t]>0));case"version":return 0===a.length||a.includes(_(e.cluster_version));default:return!0}})),d=(e,t)=>{const a=i()(e);return delete a.sortIndex,delete a.sortDirection,delete a.sort,delete a.offset,delete a.limit,a?.hits&&0===a.hits.length&&delete a.hits,((e,t)=>Object.entries(e||{}).reduce(((e,a)=>{const[r,n]=a;if(t[r]){const a=t[r],i=Array.isArray(n)?n.map((e=>{const t=a.values.find((t=>t.value===String(e)));return t?{name:t.text||t.label,value:e}:{name:e,value:e}})):[{name:a.values.find((e=>e.value===String(n))).label,value:n}];return[...e,{category:s()(a.title),chips:i,urlParam:a.urlParam}]}return"text"===r?[...e,...n.length>0?[{category:"Name",chips:[{name:n,value:n}],urlParam:r}]:[]]:"version"===r?[...e,...n.length>0?[{category:"Version",chips:n.map((e=>({name:e,value:e}))),urlParam:r}]:[]]:"namespace_name"===r?[...e,...n.length>0?[{category:"Namespace name",chips:[{name:n,value:n}],urlParam:r}]:[]]:"cluster_name"===r?[...e,...n.length>0?[{category:"Cluster name",chips:[{name:n,value:n}],urlParam:r}]:[]]:void 0}),[]))(a,t)},p=e=>{const t=new URLSearchParams(e);return Array.from(t).reduce(((e,[t,a])=>({...e,[t]:["text","first","rule_status","sort","cluster_name","namespace_name","description","object_id"].includes(t)?a:"true"===a||"false"===a?JSON.parse(a):a.split(",")})),{})},g=e=>({name:e.substring(e.startsWith("-")?1:0),direction:e.startsWith("-")?"desc":"asc",description:e.substring(e.startsWith("-")?1:0),object_id:e.substring(e.startsWith("-")?1:0)}),f=(e={},t)=>{const a=new URL(window.location.origin+window.location.pathname);var r,s,n;a.searchParams.set("sort",(r=e.sortIndex,s=t,n=e.sortDirection,["desc","asc"].includes(n)||console.error("Invalid sort parameters (is not asc nor desc)"),`${"asc"===n?"":"-"}${s[r]}`)),Object.entries(e).forEach((([e,t])=>"sortIndex"!==e&&"sortDirection"!==e&&"sort"!==e&&""!==t&&!(Array.isArray(t)&&0===t.length)&&a.searchParams.set(e,t))),window.history.replaceState(null,null,a.href)},h=(e,t,a)=>a*(0,l.compare)(e,t),_=e=>(0,l.coerce)(void 0!==e&&(0,l.valid)((0,l.coerce)(e))?e:"0.0.0").version,y=(e,t,a)=>{const{[a]:r,...s}={...e,offset:0};t({...s,..."text"===a?{text:""}:"hits"===a?{hits:[]}:"version"===a?{version:[]}:"object_id"===a?{object_id:""}:{}})},v=(e,t,a,r)=>r.length>0?t({...e,offset:0,[a]:r}):y(e,t,a),b=(e,t)=>{const a=(0,o.Vs)(e.metadata.hits_by_severity,"general");return Object.entries(t).every((([r,s])=>{switch(r){case"cluster_name":return(e.cluster.display_name||e.cluster.uuid).toLowerCase().includes(s.toLowerCase());case"namespace_name":return(e.namespace.name||e.namespace.uuid).toLowerCase().includes(s.toLowerCase());case"severity":return 0===s.length||(0,o.mR)(a,t.severity);default:return!0}}))}},83920:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var r=a(28416),s=a.n(r),n=a(58009),i=a(24561);const l=()=>s().createElement(n.Card,{ouiaId:"loading-skeleton"},s().createElement(n.CardBody,null,s().createElement(i.aV,null)))},18917:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var r=a(28416),s=a.n(r),n=a(86896),i=a(63456),l=a(2550),c=a(11042),o=a(45697),u=a.n(o),m=a(77357),d=a(75863),p=a(35981),g=a(49004),f=a(58027),h=a(13877),_=a(81563),y=a(62410),v=a(56800),b=a(38654),w=a(31630),k=a(86706),P=a(72668),E=a(18446),C=a.n(E),S=a(57642),L=a(91306),j=a(83920),x=a(94608);const D=({query:{isError:e,error:t,isUninitialized:a,isFetching:n,isSuccess:i,data:l,refetch:c}})=>{const o=(0,k.useDispatch)(),u=(0,k.useSelector)((({filters:e})=>e.workloadsListState)),E=l?.workloads||[],D=u.limit,I=Math.floor(u.offset/u.limit)+1,[W,A]=(0,r.useState)([]),[O,T]=(0,r.useState)([]),[$,B]=(0,r.useState)(!1),[Z,N]=(0,r.useState)(!1),[R,F]=(0,r.useState)(!0),M=e=>o((0,P.$4)(e)),U=a||n||!$,V=e,q=0===O.length,z=i,{search:G}=(0,v.useLocation)();(0,r.useEffect)((()=>{T(H(E))}),[l,u.namespace_name,u.cluster_name,u.severity,u.sortDirection,u.sortIndex]),(0,r.useEffect)((()=>{if(G&&R){const e=(0,S.yG)(G);if(e.sort){const t=(0,S.Lg)(e.sort);e.sortIndex=_.Bk.indexOf(t.name),e.sortDirection=t.direction}e.offset&&(e.offset=Number(e.offset[0])),e.limit&&(e.limit=Number(e.limit[0])),e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=[`${e.impacting}`]),M({...u,...e})}F(!1)}),[]),(0,r.useEffect)((()=>{R||(0,S.aM)(u,_.Bk)}),[u,R]),(0,r.useEffect)((()=>{A(J(O)),B(!0),N((0,x.wW)(u))}),[O,u.limit,u.offset]);const H=e=>(B(!1),e.filter((e=>(0,S.U1)(e,u))).sort(((e,t)=>{let a,r;const s="asc"===u.sortDirection?1:-1;switch(u.sortIndex){case _._p:return a=e.cluster?.display_name||e.cluster.uuid,r=t.cluster?.display_name||t.cluster.uuid,s*a.localeCompare(r);case _.cl:return a=e.metadata.recommendations||0,r=t.metadata.recommendations||0,a>r?s:r>a?-s:0;case _.Zg:return a=e.metadata.objects||0,r=t.metadata.objects||0,a>r?s:r>a?-s:0;case _.nU:return a=new Date(e.metadata.last_checked_at||0),r=new Date(t.metadata.last_checked_at||0),a>r?s:r>a?-s:0}}))),J=e=>e.slice(D*(I-1),D*(I-1)+D).map(((e,t)=>({entity:e,cells:[s().createElement("span",{key:t},s().createElement(v.Link,{to:`${b.G}/workloads/${e.cluster.uuid}/${e.namespace.uuid}`},s().createElement("p",{key:`${t}-cluster`},e.cluster.display_name||e.cluster.uuid),s().createElement("p",{key:`${t}-namespace`},e.namespace.name||e.namespace.uuid))),e.metadata.recommendations,e.metadata.objects,s().createElement("span",{key:t},s().createElement(y.Z,{extraTitle:"Last seen: ",date:e.metadata.last_checked_at,variant:"relative"}))]}))),Q=[{label:"Cluster name",type:"text",filterValues:{key:"cluster_name",onChange:(e,t)=>M({...u,offset:0,cluster_name:t}),value:u.cluster_name,placeholder:"Filter by cluster name"}},{label:"Namespace name",type:"text",filterValues:{key:"namespace_name",onChange:(e,t)=>M({...u,offset:0,namespace_name:t}),value:u.namespace_name,placeholder:"Filter by namespace name"}}],K={showDeleteButton:Z,deleteTitle:"Reset filters",filters:(0,S.mt)(u,_.Fy),onDelete:(e,t,a)=>{a?C()(u,P.Cz)?c():(0,P.aw)(u,P.Cz,M):t.map((e=>{const t={[e.urlParam]:Array.isArray(u[e.urlParam])?u[e.urlParam].filter((t=>String(t)!==String(e.chips[0].value))):""};var a;t[e.urlParam].length>0?M({...u,...t}):(a=e.urlParam,(0,S.oo)(u,M,a))}))}},X=(e,t)=>{B(!1);const a=t*u.limit-u.limit;M({...u,offset:a})},Y=(e,t)=>{t!==u.limit&&(B(!1),M({...u,limit:t,offset:0}))};return e&&404===t.status||i&&0===E.length?s().createElement(L.sl,null):s().createElement("div",{id:"workloads-list-table"},s().createElement(m.Z,{pagination:{itemCount:O.length,page:I,perPage:D,onSetPage:X,onPerPageSelect:Y,isCompact:!0,ouiaId:"pager"},filterConfig:{items:Q},activeFiltersConfig:e?{showDeleteButton:!1}:K}),s().createElement(p.i,{"aria-label":"Table of workloads",ouiaId:"workloads",variant:d.B.compact,cells:_.go,rows:V||U||q?[{fullWidth:!0,cells:[{props:{colSpan:_.go.length+1},title:V?s().createElement(L.Te,null):U?s().createElement(j.Z,null):s().createElement(L.DH,null)}]}]:z?W:s().createElement(L.Te,null),isStickyHeader:!0,sortBy:{index:u.sortIndex,direction:u.sortDirection},onSort:(e,t,a)=>{B(!1),M({...u,sortIndex:t,sortDirection:a})}},s().createElement(g.x,null),s().createElement(f.R,null)),s().createElement(w.Pagination,{ouiaId:"pager",itemCount:O.length,page:I,perPage:D,onSetPage:X,onPerPageSelect:Y,onPageInput:X,widgetId:"pagination-options-menu-bottom",variant:h.aM.bottom}))};D.propTypes={query:u().object.isRequired};const I=()=>{const e=(0,c.mJ)();return s().createElement(D,{query:e})};var W=a(77697),A=a(55140);const O=()=>{const e=(0,n.Z)();return(0,A.Z)().updateDocumentTitle(e.formatMessage(l.Z.documentTitle,{subnav:"Workloads"})),s().createElement(s().Fragment,null,s().createElement(i.Z,{className:"ins-c-clusters-header"},s().createElement(W.Title,{headingLevel:"h1",ouiaId:"page-header"},"Workloads")),s().createElement("section",{className:"pf-l-page__main-section pf-c-page__main-section"},s().createElement(I,null)))}},94608:(e,t,a)=>{"use strict";a.d(t,{Q$:()=>f,Vs:()=>i,ke:()=>p,l8:()=>g,lM:()=>m,mR:()=>l,p5:()=>h,sI:()=>_,wW:()=>c,y4:()=>y});var r=a(48585),s=a(44439),n=a.n(s);const i=(e,t)=>{const a={1:"low",2:"moderate",3:"important",4:"critical"};let r={};if("general"===t||"label"===t)for(const t in e)t in a&&(r[a[t]]=e[t]);else r=a[e];return r},l=(e,t)=>{for(const a of t)if(e[a]>0)return!0},c=e=>{const t=n().cloneDeep(e);return delete t.sortIndex,delete t.sortDirection,delete t.offset,delete t.limit,delete t.sort,!!Object.values(t).filter((e=>!n().isEmpty(e))).length},o=e=>e?.charAt(0).toUpperCase()+e?.slice(1),u=(e,t)=>{if(e.values){const a=e.values.find((e=>e.value===String(t)));return a?{name:a.label||a.text,value:t}:{name:t,value:t}}return{name:t,value:t}},m=(e,t)=>Object.entries(e).reduce(((e,[a,r])=>{if(t[a]){const s=t[a];if(Array.isArray(r)&&r.length>0||"string"==typeof r&&""!==r.trim()){const t=Array.isArray(r)?r.map((e=>u(s,e))):[u(s,r)];e.push({category:o(s.label),chips:t,urlParam:s.urlParam})}}else"description"!==a&&"object_id"!==a||""===r.trim()||e.push({category:o(a.replace("_"," ")),chips:[{name:r,value:r}],urlParam:a});return e}),[]),d=(e,t)=>{const a=t[0].rule;switch(e){case 1:return a.details;case 2:return a.total_risk;case 3:return a.objects.length;case 4:return a.modified}},p=(e,t,a)=>e>=1?[...a]?.sort(((a,s)=>{const n=t===r.B.asc?1:-1;return d(e,a)>d(e,s)?n:d(e,s)>d(e,a)?-n:0})):[...a],g=(e,t)=>e.flatMap(((e,a)=>{const r=[...e];return t&&0===a&&(e[0].isOpen=!0),e[1].parent=2*a,r})),f=(e,t)=>Object.entries(t).some((([t,a])=>"object_id"===t&&e.uid.toLowerCase().includes(a.toLowerCase()))),h=(e,t,a)=>{const{[a]:r,...s}={...e};t({...s,..."description"===a?{description:""}:"total_risk"===a?{total_risk:[]}:"object_id"===a?{object_id:""}:{}})},_=(e,t,a,r)=>r.length>0?t({...e,[a]:r}):h(e,t,a),y=(e,t)=>{const a=n().omitBy(n().cloneDeep(t),n().isEmpty);return Object.entries(a).every((([t,a])=>{switch(t){case"description":return a&&e.details.toLowerCase().includes(a.toLowerCase());case"object_id":return a&&e.objects.some((e=>e.uid.toLowerCase().includes(a.toLowerCase())));case"total_risk":return a&&a.includes(String(e.total_risk));default:return!0}}))}},65088:()=>{},58392:()=>{},32857:()=>{},28992:()=>{},30187:()=>{},90479:()=>{},21626:()=>{},8572:()=>{},98379:()=>{},46928:()=>{},91993:()=>{},54994:()=>{},44690:()=>{},37494:()=>{},87234:()=>{}}]);
//# sourceMappingURL=../sourcemaps/WorkloadsList.e4a435807944c6388c1e0a01264defa8.js.map