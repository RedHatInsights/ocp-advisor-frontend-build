(self.webpackChunkocpAdvisor=self.webpackChunkocpAdvisor||[]).push([[9420],{99461:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var r=s(28416),a=s.n(r),l=s(86896),i=s(63456),n=s(2550),o=s(11042),c=s(45697),u=s.n(c),m=s(86706),f=s(18446),d=s.n(f),_=s(56800),g=s(45578),p=s.n(g),h=s(81249),v=s(48585),y=s(75863),E=s(35981),k=s(49004),b=s(58027),x=s(94992),Z=s(90766),C=s(8780),S=s(13877),T=s(90111),L=s.n(T),P=s(62410),M=s(77572),w=s(72668),I=s(81563),A=s(57642),D=s(83920),R=s(91306),$=s(38654),B=s(33366),N=s(39403);const V=({query:{isError:e,isUninitialized:t,isFetching:s,isSuccess:i,data:o,refetch:c}})=>{const u=(0,N.ji)(),f=(0,l.Z)(),g=(0,m.useDispatch)(),T=e=>g((0,w.$Q)(e)),V=(0,m.useSelector)((({filters:e})=>e.clustersListState)),W=o?.data||[],F=V.offset/V.limit+1,[q,j]=(0,r.useState)([]),[G,H]=(0,r.useState)([]),[O,U]=(0,r.useState)(!1),[z,Q]=(0,r.useState)(!0),{search:J}=(0,_.useLocation)(),K=t||s||!O,X=e,Y=i,ee=W.length>0&&0===q?.length&&0===G?.length,te=(0,B.Vk)(),se=(e,t)=>(0,A.Lv)(V,T,e,t);(0,r.useEffect)((()=>{const e=new AbortController,t=e.signal;return(async()=>{U(!1);const e=await ae(q,t);"cancel"!==e&&(H(e),U(!0))})(),()=>{e.abort()}}),[q,V.limit,V.offset,u]),(0,r.useEffect)((()=>{U(!1),j(re(W))}),[o,V.text,V.version,V.hits,V.sortDirection,V.sortIndex]),(0,r.useEffect)((()=>{if(J&&z){const e=(0,A.yG)(J);if(e.sort){const t=(0,A.Lg)(e.sort);e.sortIndex=I.lo.indexOf(t.name),e.sortDirection=t.direction}e.offset&&(e.offset=Number(e.offset[0])),e.limit&&(e.limit=Number(e.limit[0])),e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=[`${e.impacting}`]),T({...V,...e})}Q(!1)}),[]),(0,r.useEffect)((()=>{z||(0,A.aM)(V,I.lo)}),[V,z]);const re=e=>{const t=e.filter((e=>(0,A.im)(e,V))).map((e=>({it:e,cells:[e.cluster_name||e.cluster_id,e.cluster_version,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,e.last_checked_at]})));return-1===V.sortIndex?t:t.sort(((e,t)=>{let s,r;const a=V.sortDirection===v.B.asc?1:-1;switch(V.sortIndex){case I.v7:return s=e.it.cluster_name||e.it.cluster_id,r=t.it.cluster_name||t.it.cluster_id,s.localeCompare(r)?s.localeCompare(r)*a:0;case I._s:return(0,A._)((0,A.WL)(e.it.cluster_version),(0,A.WL)(t.it.cluster_version),a);case I.CL:return s=new Date(e.it.last_checked_at||0),r=new Date(t.it.last_checked_at||0),s>r?a:r>s?-a:0;default:return s=e.cells[V.sortIndex],r=t.cells[V.sortIndex],s>r?a:r>s?-a:0}}))},ae=async(e,t)=>{const s=e?.slice(V.limit*(F-1),V.limit*(F-1)+V.limit),r=s?.map((e=>e.it.cluster_id));let l=[];if(r?.length>0&&u){let e=null;try{e=await te.post("/api/insights-results-aggregator/v2/upgrade-risks-prediction",{clusters:r},{signal:t})}catch(e){console.log(e)}if(void 0===e)return"cancel";"ok"===e?.status&&(l=e.predictions.map((e=>e)))}const i=s?.map((({it:e},t)=>{void 0===e.cluster_version||""===e.cluster_version||(0,h.valid)((0,h.coerce)(e.cluster_version))||console.error(`Cluster version ${e.cluster_version} has invalid format!`);const s=(0,A.WL)(e.cluster_version),r=Array.isArray(l)&&!1===l.find((t=>t?.cluster_id===e?.cluster_id))?.upgrade_recommended;return{entity:e,cells:[a().createElement("span",{key:e.cluster_id,className:"pf-v5-l-flex"},a().createElement(_.Link,{key:`${e.cluster_id}-link`,to:`${$.G}/clusters/${e.cluster_id}`,className:"pf-v5-l-flex__item"},e.cluster_name||e.cluster_id),r&&a().createElement(x.Label,{isCompact:!0,color:"orange",className:"pf-v5-l-flex__item"},"Update risk")),"0.0.0"===s?f.formatMessage(n.Z.nA):s,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,a().createElement("span",{key:t},e.last_checked_at?a().createElement(P.Z,{extraTitle:`${f.formatMessage(n.Z.lastSeen)}: `,date:e.last_checked_at,variant:"relative"}):a().createElement(C.Tooltip,{key:t,content:a().createElement("span",null,f.formatMessage(n.Z.lastSeen)+": ",f.formatMessage(n.Z.nA))},a().createElement("span",null,f.formatMessage(n.Z.nA))))]}}));return i},le=[{label:f.formatMessage(n.Z.name).toLowerCase(),type:"text",filterValues:{key:"text-filter",onChange:(e,t)=>T({...V,offset:0,text:t}),value:V.text,placeholder:f.formatMessage(n.Z.filterByName)}},{label:f.formatMessage(n.Z.version),placeholder:f.formatMessage(n.Z.filterByVersion),type:M.conditionalFilterType.checkbox,filterValues:{id:"version-filter",key:"version-filter",onChange:(e,t)=>se("version",t),value:V.version,items:p()(W.filter((e=>void 0!==e.cluster_version&&""!==e.cluster_version)).map((e=>({label:e.cluster_version,value:(0,A.WL)(e.cluster_version)}))).sort(((e,t)=>(0,A._)((0,A.WL)(e.cluster_version),(0,A.WL)(t.cluster_version),1))).reverse(),"value")}},{label:I.RT.hits.title,type:I.RT.hits.type,id:I.RT.hits.urlParam,value:`checkbox-${I.RT.hits.urlParam}`,filterValues:{key:`${I.RT.hits.urlParam}-filter`,onChange:(e,t)=>se(I.RT.hits.urlParam,t),value:V.hits,items:I.RT.hits.values}}],ie={showDeleteButton:!0,deleteTitle:f.formatMessage(n.Z.resetFilters),filters:(0,A.mt)(V,I.RT),onDelete:(e,t,s)=>{s?d()(V,w.Ly)?c():(0,w.aw)(V,w.Ly,T):t.map((e=>{const t={[e.urlParam]:Array.isArray(V[e.urlParam])?V[e.urlParam].filter((t=>String(t)!==String(e.chips[0].value))):""};var s;t[e.urlParam].length>0?T({...V,...t}):(s=e.urlParam,(0,A.oo)(V,T,s))}))}};return a().createElement(a().Fragment,null,i&&0===W.length?a().createElement(R.ER,null):a().createElement("div",{id:"clusters-list-table","data-ouia-safe":!K},a().createElement(L(),{pagination:{itemCount:q.length,page:F,perPage:V.limit,onSetPage:(e,t)=>(U(!1),T({...V,offset:V.limit*(t-1)})),onPerPageSelect:(e,t)=>(U(!1),T({...V,limit:t,offset:0})),isCompact:!0,ouiaId:"pager"},filterConfig:{items:le},activeFiltersConfig:ie}),a().createElement(E.i,{"aria-label":"Table of clusters",ouiaId:"clusters",ouiaSafe:!K,variant:y.B.compact,cells:I.Bg,rows:X||K||ee?[{fullWidth:!0,cells:[{props:{colSpan:I.Bg.length+1},title:X?a().createElement(R.Te,null):K?a().createElement(D.Z,null):a().createElement(R.VA,null)}]}]:Y?G:a().createElement(R.Te,null),sortBy:{index:V.sortIndex,direction:V.sortDirection},onSort:(e,t,s)=>{U(!1),T({...V,sortIndex:t,sortDirection:s})},isStickyHeader:!0},a().createElement(k.x,null),a().createElement(b.R,null)),a().createElement(Z.Pagination,{ouiaId:"pager",itemCount:q.length,page:V.offset/V.limit+1,perPage:Number(V.limit),onSetPage:(e,t)=>T({...V,offset:V.limit*(t-1)}),onPerPageSelect:(e,t)=>T({...V,limit:t,offset:0}),widgetId:"pagination-options-menu-bottom",variant:S.aM.bottom})))};V.propTypes={query:u().object.isRequired};const W=()=>{const e=(0,o.Oj)();return a().createElement(V,{query:e})};var F=s(50318),q=s(55140);const j=()=>{const e=(0,l.Z)();return(0,q.Z)().updateDocumentTitle(e.formatMessage(n.Z.documentTitle,{subnav:e.formatMessage(n.Z.clusters)})),a().createElement(a().Fragment,null,a().createElement(i.Z,{className:"ins-c-clusters-header"},a().createElement(F.Title,{headingLevel:"h1",ouiaId:"page-header"},`${e.formatMessage(n.Z.insightsHeader)} ${e.formatMessage(n.Z.clusters).toLowerCase()}`)),a().createElement("section",{className:"pf-l-page__main-section pf-c-page__main-section"},a().createElement(W,null)))}},83920:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(28416),a=s.n(r),l=s(67073),i=s(24561);const n=()=>a().createElement(l.Card,{ouiaId:"loading-skeleton"},a().createElement(l.CardBody,null,a().createElement(i.aV,null)))},36974:()=>{}}]);
//# sourceMappingURL=../sourcemaps/ClustersList.12ef736c403f3138414059c3ef62dfd4.js.map