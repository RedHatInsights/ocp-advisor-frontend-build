"use strict";(self.webpackChunkocp_advisor_frontend=self.webpackChunkocp_advisor_frontend||[]).push([[384],{50689:(e,t,r)=>{r.r(t),r.d(t,{default:()=>A});var a=r(93264),n=r.n(a),i=r(15861),l=r(93433),o=r(4942),c=r(29439),u=r(87757),s=r.n(u),m=r(88931),f=r(86896),d=r(16530),p=r(45697),g=r.n(p),v=r(94550),b=r(56161),y=r(18246),h=r(88292),k=r(8045),P=r(62410),_=r(78216),W=r(90111),Z=r(71355),E=r(59303),x=r(30893),M=r(28672),C=r(31728),S=r(28186),O=r(52661),w=r(51014),T=r(1990),j=r(58788),D=r(77647),I=function(e){var t=e.isModalOpen,r=e.handleModalToggle,l=e.rule,o=e.afterFn,u=(0,f.Z)(),d=(0,a.useState)(""),p=(0,c.Z)(d,2),g=p[0],v=p[1],b=(0,D.o)(),y=(0,c.Z)(b,1)[0],h=(0,m.useDispatch)(),k=function(e){return h((0,Z.wN)(e))},P=function(){var e=(0,i.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={rule_id:l.rule_id,justification:g},e.prev=1,e.next=4,y(t).unwrap();case 4:k({variant:"success",timeout:!0,dismissable:!0,title:u.formatMessage(x.Z.recSuccessfullyDisabled)}),v(""),o&&o(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),k({variant:"danger",dismissable:!0,title:u.formatMessage(x.Z.error),description:"".concat(e.t0)});case 12:r(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();return n().createElement(j.Modal,{variant:"small",title:u.formatMessage(x.Z.disableRule),isOpen:t,onClose:function(){r(),v("")},actions:[n().createElement(j.Button,{key:"confirm",variant:"primary",onClick:function(){return P()},ouiaId:"confirm"},u.formatMessage(x.Z.save)),n().createElement(j.Button,{key:"cancel",variant:"link",onClick:function(){r(!1),v("")},ouiaId:"cancel"},u.formatMessage(x.Z.cancel))]},u.formatMessage(x.Z.disableRuleBody),n().createElement(j.Form,null,n().createElement(j.FormGroup,{fieldId:"blank-form"}),n().createElement(j.FormGroup,{label:u.formatMessage(x.Z.justificationNote),fieldId:"disable-rule-justification"},n().createElement(j.TextInput,{type:"text",id:"disable-rule-justification","aria-describedby":"disable-rule-justification",value:g,onChange:function(e){return v(e)},onKeyDown:function(e){return"Enter"===e.key&&(e.preventDefault(),P())}}))))};I.propTypes={isModalOpen:g().bool,rule:g().object,handleModalToggle:g().func,afterFn:g().func},I.defaultProps={isModalOpen:!1,rule:{},handleModalToggle:function(){},afterFn:function(){}};const F=I;var B=r(71094),Q=r(86362);function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q=function(e){var t=e.query,r=(0,f.Z)(),u=(0,m.useDispatch)(),p=(0,m.useSelector)((function(e){return e.filters.recsListState})),g=t.isError,j=t.isUninitialized,D=t.isFetching,I=t.isSuccess,R=t.data,q=t.refetch,A=(null==R?void 0:R.recommendations)||[],N=p.offset/p.limit+1,L=(0,a.useState)([]),G=(0,c.Z)(L,2),H=G[0],U=G[1],z=(0,a.useState)([]),K=(0,c.Z)(z,2),X=K[0],J=K[1],Y=(0,a.useState)(!1),$=(0,c.Z)(Y,2),ee=$[0],te=$[1],re=(0,a.useState)({}),ae=(0,c.Z)(re,2),ne=ae[0],ie=ae[1],le=function(e){return u((0,Z.wN)(e))};(0,a.useEffect)((function(){J(ue(H,p.sortIndex,p.sortDirection))}),[H,p.limit,p.offset,p.sortIndex,p.sortDirection]),(0,a.useEffect)((function(){U(ce(A,p))}),[R,p]);var oe,ce=function(e,t){return e.filter((function(e){return function(e,t){return Object.entries(t).every((function(t){var r=(0,c.Z)(t,2),a=r[0],n=r[1];switch(a){case"text":return e.description.toLowerCase().includes(n.toLowerCase());case E.W2.total_risk.urlParam:return n.includes(String(e.total_risk));case E.W2.category.urlParam:return e.tags.find((function(e){return n.includes(String(E.kT[e]))}));case E.W2.impact.urlParam:return n.includes(String(e.impact));case E.W2.impacting.urlParam:return!(n.length>0)||n.some((function(t){return"true"===t?e.impacted_clusters_count>0:"false"===t?0===e.impacted_clusters_count:void 0}));case E.W2.likelihood.urlParam:return n.includes(String(e.likelihood));case E.W2.rule_status.urlParam:return"all"===n||"disabled"===n&&e.disabled||"enabled"===n&&!e.disabled;default:return!0}}))}(e,t)})).map((function(e,t){return[{isOpen:!1,rule:e,cells:[{title:n().createElement("span",{key:t},n().createElement(d.Link,{key:t,to:"/recommendations/".concat(e.rule_id)}," ",(null==e?void 0:e.description)||(null==e?void 0:e.rule_id)," "),n().createElement(C.Z,{rule:e}))},{title:null!=e&&e.publish_date?n().createElement(P.Z,{key:t,date:e.publish_date,variant:"relative"}):r.formatMessage(x.Z.nA)},{title:n().createElement("div",{key:t},n().createElement(k.Tooltip,{key:t,position:k.TooltipPosition.bottom,content:r.formatMessage(x.Z.rulesDetailsTotalRiskBody,{risk:E.Nq[e.total_risk]||r.formatMessage(x.Z.undefined),strong:function(e){return(0,S.f)(e)}})},null!=e&&e.total_risk?n().createElement(_.Z,{value:e.total_risk}):r.formatMessage(x.Z.nA)))},{title:n().createElement("div",{key:t},"".concat(void 0!==(null==e?void 0:e.impacted_clusters_count)?e.impacted_clusters_count.toLocaleString():r.formatMessage(x.Z.nA)))}]},{fullWidth:!0,cells:[{title:n().createElement("section",{className:"pf-m-light pf-l-page__main-section pf-c-page__main-section"},n().createElement(h.Stack,{hasGutter:!0},n().createElement(T.Z,{rule:V(V({},e),{},{impact:{impact:e.impact},impacted_clusters_count:void 0}),isDetailsPage:!1})))}]}]}))},ue=function(e,t,r){var a=["description","publish_date","total_risk","impacted_clusters_count"],n=(0,l.Z)(e).sort((function(e,r){var n=e[0].rule[a[t-1]],i=r[0].rule[a[t-1]];return n>i?1:i>n?-1:0}));return r===v.SortByDirection.desc&&n.reverse(),n.slice(p.limit*(N-1),p.limit*(N-1)+p.limit).flatMap((function(e,t){var r=(0,l.Z)(e);return e[1].parent=2*t,r}))},se=function(e){var t=V(V({},p),{},{offset:0});delete t[e],u((0,M.Q4)(V(V({},t),"text"===e?{text:""}:{})))},me=function(e,t){t.length>0?u((0,M.Q4)(V(V({},p),{},{offset:0},(0,o.Z)({},e,t)))):se(e)},fe=[{label:r.formatMessage(x.Z.name).toLowerCase(),filterValues:{key:"text-filter",onChange:function(e,t){return u((0,M.Q4)(V(V({},p),{},{text:t})))},value:p.text,placeholder:r.formatMessage(x.Z.filterBy)}},{label:E.W2.total_risk.title,type:E.W2.total_risk.type,id:E.W2.total_risk.urlParam,value:"checkbox-".concat(E.W2.total_risk.urlParam),filterValues:{key:"".concat(E.W2.total_risk.urlParam,"-filter"),onChange:function(e,t){return me(E.W2.total_risk.urlParam,t)},value:p.total_risk,items:E.W2.total_risk.values}},{label:E.W2.impact.title,type:E.W2.impact.type,id:E.W2.impact.urlParam,value:"checkbox-".concat(E.W2.impact.urlParam),filterValues:{key:"".concat(E.W2.impact.urlParam,"-filter"),onChange:function(e,t){return me(E.W2.impact.urlParam,t)},value:p.impact,items:E.W2.impact.values}},{label:E.W2.likelihood.title,type:E.W2.likelihood.type,id:E.W2.likelihood.urlParam,value:"checkbox-".concat(E.W2.likelihood.urlParam),filterValues:{key:"".concat(E.W2.likelihood.urlParam,"-filter"),onChange:function(e,t){return me(E.W2.likelihood.urlParam,t)},value:p.likelihood,items:E.W2.likelihood.values}},{label:E.W2.category.title,type:E.W2.category.type,id:E.W2.category.urlParam,value:"checkbox-".concat(E.W2.category.urlParam),filterValues:{key:"".concat(E.W2.category.urlParam,"-filter"),onChange:function(e,t){return me(E.W2.category.urlParam,t)},value:p.category,items:E.W2.category.values}},{label:E.W2.rule_status.title,type:E.W2.rule_status.type,id:E.W2.rule_status.urlParam,value:"radio-".concat(E.W2.rule_status.urlParam),filterValues:{key:"".concat(E.W2.rule_status.urlParam,"-filter"),onChange:function(e,t){return r=t,void u((0,M.Q4)(V(V({},p),{},{rule_status:r,offset:0},"enabled"!==r&&{impacting:["false"]})));var r},value:"".concat(p.rule_status),items:E.W2.rule_status.values}},{label:E.W2.impacting.title,type:E.W2.impacting.type,id:E.W2.impacting.urlParam,value:"checkbox-".concat(E.W2.impacting.urlParam),filterValues:{key:"".concat(E.W2.impacting.urlParam,"-filter"),onChange:function(e,t){return me(E.W2.impacting.urlParam,t)},value:p.impacting,items:E.W2.impacting.values}}],de={deleteTitle:r.formatMessage(x.Z.resetFilters),filters:(oe=V({},p),delete oe.sortIndex,delete oe.sortDirection,delete oe.offset,delete oe.limit,function(e,t){var r=Object.entries(e);return r.length>0?r.reduce((function(e,r){if(t[r[0]]){var a=t[r[0]],n=Array.isArray(r[1])?r[1].map((function(e){var t=a.values.find((function(t){return t.value===String(e)}));return t?{name:t.text||t.label,value:e}:{name:e,value:e}})):[{name:a.values.find((function(e){return e.value===String(r[1])})).label,value:r[1]}];return[].concat((0,l.Z)(e),[{category:(i=a.title,i[0].toUpperCase()+i.substring(1)),chips:n,urlParam:a.urlParam}])}return"text"===r[0]?[].concat((0,l.Z)(e),(0,l.Z)(r[1].length>0?[{category:"Name",chips:[{name:r[1],value:r[1]}],urlParam:r[0]}]:[])):e;var i}),[]):[]}(oe,E.W2)),onDelete:function(e,t,r){r?u((0,M.Q4)(M.CH)):t.map((function(e){var t=(0,o.Z)({},e.urlParam,Array.isArray(p[e.urlParam])?p[e.urlParam].filter((function(t){return String(t)!==String(e.chips[0].value)})):"");t[e.urlParam].length>0?u((0,M.Q4)(V(V({},p),t))):se(e.urlParam)}))}},pe=function(){var e=(0,i.Z)(s().mark((function e(t){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=X[t].rule,e.prev=1,a.disabled){e.next=7;break}ie(a),te(!0),e.next=17;break;case 7:return e.prev=7,e.next=10,(0,B.H)("".concat(Q._n,"/v2/ack/").concat(a.rule_id,"/"));case 10:le({variant:"success",timeout:!0,dismissable:!0,title:r.formatMessage(x.Z.recSuccessfullyEnabled)}),q(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),le({variant:"danger",dismissable:!0,title:r.formatMessage(x.Z.error),description:"".concat(e.t0)});case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(1),le({variant:"danger",dismissable:!0,title:a.disabled?r.formatMessage(x.Z.rulesTableErrorEnabled):r.formatMessage(x.Z.rulesTableErrorDisabled),description:"".concat(e.t1)});case 22:case"end":return e.stop()}}),e,null,[[1,19],[7,14]])})));return function(t){return e.apply(this,arguments)}}();return n().createElement("div",{id:"recs-list-table"},ee&&n().createElement(F,{handleModalToggle:te,isModalOpen:ee,rule:ne,afterFn:q}),n().createElement(W.Z,{pagination:{itemCount:H.length,page:p.offset/p.limit+1,perPage:Number(p.limit),onSetPage:function(e,t){u((0,M.Q4)(V(V({},p),{},{offset:p.limit*(t-1)})))},onPerPageSelect:function(e,t){u((0,M.Q4)(V(V({},p),{},{limit:t,offset:0})))},isCompact:!0},filterConfig:{items:fe},activeFiltersConfig:de}),(j||D)&&n().createElement(O.Z,null),(g||I&&0===A.length)&&n().createElement(b.Card,null,n().createElement(b.CardBody,null,n().createElement(w.Te,null))),!(j||D)&&I&&A.length>0&&n().createElement(n().Fragment,null,n().createElement(v.Table,{"aria-label":"Table of recommendations",ouiaId:"recsListTable",variant:v.TableVariant.compact,cells:E.XT,rows:X,onCollapse:function(e,t,r){var a=(0,l.Z)(X);a[t]=V(V({},a[t]),{},{isOpen:r}),J(a)},sortBy:{index:p.sortIndex,direction:p.sortDirection},onSort:function(e,t,r){u((0,M.Q4)(V(V({},p),{},{sortIndex:t,sortDirection:r})))},actionResolver:function(e,t){var a=t.rowIndex,n=X[a].rule?X[a].rule:null;return a%2==0&&n?n&&!n.disabled?[{title:r.formatMessage(x.Z.disableRule),onClick:function(e,t){return pe(t)}}]:[{title:r.formatMessage(x.Z.enableRule),onClick:function(e,t){return pe(t)}}]:null}},n().createElement(v.TableHeader,null),n().createElement(v.TableBody,null)),A.length>0&&0===H.length&&n().createElement(b.Card,{ouiaId:"empty-recommendations"},n().createElement(b.CardBody,null,n().createElement(w.A0,null)))),n().createElement(y.Pagination,{ouiaId:"recs-list-pagination-bottom",itemCount:H.length,page:p.offset/p.limit+1,perPage:Number(p.limit),onSetPage:function(e,t){u((0,M.Q4)(V(V({},p),{},{offset:p.limit*(t-1)})))},onPerPageSelect:function(e,t){u((0,M.Q4)(V(V({},p),{},{limit:t,offset:0})))},widgetId:"pagination-options-menu-bottom",variant:y.PaginationVariant.bottom}))};q.propTypes={query:g().shape({isError:g().bool.isRequired,isUninitialized:g().bool.isRequired,isFetching:g().bool.isRequired,isSuccess:g().bool.isRequired,data:g().array,refetch:g().func})};const A=function(){var e=(0,Q.Bs)();return n().createElement(q,{query:e})}}}]);