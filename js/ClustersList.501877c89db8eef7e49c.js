(self.webpackChunkocpAdvisor=self.webpackChunkocpAdvisor||[]).push([[9420,4693,8024,8299],{99461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var s=r(28416),a=r.n(s),i=r(86896),l=r(63456),n=r(2550),o=r(11042),c=r(45697),u=r.n(c),m=r(86706),d=r(18446),_=r.n(d),f=r(56800),p=r(45578),g=r.n(p),h=r(81249),v=r(48585),y=r(75863),b=r(35981),k=r(49004),w=r(58027),E=r(62632),P=r(31630),L=r(38595),C=r(13877),x=r(90111),S=r.n(x),j=r(62410),A=r(77572),T=r(72668),I=r(81563),Z=r(57642),W=r(83920),M=r(91306),D=r(38654),R=r(33366),$=r(39403);const O=({query:{isError:e,isUninitialized:t,isFetching:r,isSuccess:l,data:o,refetch:c}})=>{const u=(0,$.ji)(),d=(0,$.cT)(),p=(0,i.Z)(),x=(0,m.useDispatch)(),O=e=>x((0,T.$Q)(e)),N=(0,m.useSelector)((({filters:e})=>e.clustersListState)),B=o?.data||[],V=N.offset/N.limit+1,[F,U]=(0,s.useState)([]),[q,G]=(0,s.useState)([]),[H,Q]=(0,s.useState)(!1),[z,J]=(0,s.useState)(!0),{search:K}=(0,f.useLocation)(),X=t||r||!H,Y=e,ee=l,te=B.length>0&&0===F?.length&&0===q?.length,re=(0,R.Vk)(),se=(e,t)=>(0,Z.Lv)(N,O,e,t);(0,s.useEffect)((()=>{const e=new AbortController,t=e.signal;return(async()=>{Q(!1);const e=await ie(F,t);"cancel"!==e&&(G(e),Q(!0))})(),()=>{e.abort()}}),[F,N.limit,N.offset,u,d]),(0,s.useEffect)((()=>{Q(!1),U(ae(B))}),[o,N.text,N.version,N.hits,N.sortDirection,N.sortIndex]),(0,s.useEffect)((()=>{if(K&&z){const e=(0,Z.yG)(K);if(e.sort){const t=(0,Z.Lg)(e.sort);e.sortIndex=I.lo.indexOf(t.name),e.sortDirection=t.direction}e.offset&&(e.offset=Number(e.offset[0])),e.limit&&(e.limit=Number(e.limit[0])),e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=[`${e.impacting}`]),O({...N,...e})}J(!1)}),[]),(0,s.useEffect)((()=>{z||(0,Z.aM)(N,I.lo)}),[N,z]);const ae=e=>{const t=e.filter((e=>(0,Z.im)(e,N))).map((e=>({it:e,cells:[e.cluster_name||e.cluster_id,e.cluster_version,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,e.last_checked_at]})));return-1===N.sortIndex?t:t.sort(((e,t)=>{let r,s;const a=N.sortDirection===v.B.asc?1:-1;switch(N.sortIndex){case I.v7:return r=e.it.cluster_name||e.it.cluster_id,s=t.it.cluster_name||t.it.cluster_id,r.localeCompare(s)?r.localeCompare(s)*a:0;case I._s:return(0,Z._)((0,Z.WL)(e.it.cluster_version),(0,Z.WL)(t.it.cluster_version),a);case I.CL:return r=new Date(e.it.last_checked_at||0),s=new Date(t.it.last_checked_at||0),r>s?a:s>r?-a:0;default:return r=e.cells[N.sortIndex],s=t.cells[N.sortIndex],r>s?a:s>r?-a:0}}))},ie=async(e,t)=>{const r=e?.slice(N.limit*(V-1),N.limit*(V-1)+N.limit),s=r?.map((e=>e.it.cluster_id));let i=[];if(s?.length>0&&u&&d){let e=null;try{e=await re.post("/api/insights-results-aggregator/v2/upgrade-risks-prediction",{clusters:s},{signal:t})}catch(e){console.log(e)}if(void 0===e)return"cancel";"ok"===e?.status&&(i=e.predictions.map((e=>e)))}const l=r?.map((({it:e},t)=>{void 0===e.cluster_version||""===e.cluster_version||(0,h.valid)((0,h.coerce)(e.cluster_version))||console.error(`Cluster version ${e.cluster_version} has invalid format!`);const r=(0,Z.WL)(e.cluster_version),s=Array.isArray(i)&&!1===i.find((t=>t?.cluster_id===e?.cluster_id))?.upgrade_recommended;return{entity:e,cells:[a().createElement("span",{key:e.cluster_id,className:"pf-v5-l-flex"},a().createElement(f.Link,{key:`${e.cluster_id}-link`,to:`${D.G}/clusters/${e.cluster_id}`,className:"pf-v5-l-flex__item"},e.cluster_name||e.cluster_id),s&&a().createElement(E.Label,{isCompact:!0,color:"orange",className:"pf-v5-l-flex__item"},"Update risk")),"0.0.0"===r?p.formatMessage(n.Z.nA):r,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,a().createElement("span",{key:t},e.last_checked_at?a().createElement(j.Z,{extraTitle:`${p.formatMessage(n.Z.lastSeen)}: `,date:e.last_checked_at,variant:"relative"}):a().createElement(L.Tooltip,{key:t,content:a().createElement("span",null,p.formatMessage(n.Z.lastSeen)+": ",p.formatMessage(n.Z.nA))},a().createElement("span",null,p.formatMessage(n.Z.nA))))]}}));return l},le=[{label:p.formatMessage(n.Z.name).toLowerCase(),type:"text",filterValues:{key:"text-filter",onChange:(e,t)=>O({...N,offset:0,text:t}),value:N.text,placeholder:p.formatMessage(n.Z.filterByName)}},{label:p.formatMessage(n.Z.version),placeholder:p.formatMessage(n.Z.filterByVersion),type:A.conditionalFilterType.checkbox,filterValues:{id:"version-filter",key:"version-filter",onChange:(e,t)=>se("version",t),value:N.version,items:g()(B.filter((e=>void 0!==e.cluster_version&&""!==e.cluster_version)).map((e=>({label:e.cluster_version,value:(0,Z.WL)(e.cluster_version)}))).sort(((e,t)=>(0,Z._)((0,Z.WL)(e.cluster_version),(0,Z.WL)(t.cluster_version),1))).reverse(),"value")}},{label:I.RT.hits.title,type:I.RT.hits.type,id:I.RT.hits.urlParam,value:`checkbox-${I.RT.hits.urlParam}`,filterValues:{key:`${I.RT.hits.urlParam}-filter`,onChange:(e,t)=>se(I.RT.hits.urlParam,t),value:N.hits,items:I.RT.hits.values}}],ne={showDeleteButton:!0,deleteTitle:p.formatMessage(n.Z.resetFilters),filters:(0,Z.mt)(N,I.RT),onDelete:(e,t,r)=>{r?_()(N,T.Ly)?c():(0,T.aw)(N,T.Ly,O):t.map((e=>{const t={[e.urlParam]:Array.isArray(N[e.urlParam])?N[e.urlParam].filter((t=>String(t)!==String(e.chips[0].value))):""};var r;t[e.urlParam].length>0?O({...N,...t}):(r=e.urlParam,(0,Z.oo)(N,O,r))}))}};return a().createElement(a().Fragment,null,l&&0===B.length?a().createElement(M.ER,null):a().createElement("div",{id:"clusters-list-table","data-ouia-safe":!X},a().createElement(S(),{pagination:{itemCount:F.length,page:V,perPage:N.limit,onSetPage:(e,t)=>(Q(!1),O({...N,offset:N.limit*(t-1)})),onPerPageSelect:(e,t)=>(Q(!1),O({...N,limit:t,offset:0})),isCompact:!0,ouiaId:"pager"},filterConfig:{items:le},activeFiltersConfig:ne}),a().createElement(b.i,{"aria-label":"Table of clusters",ouiaId:"clusters",ouiaSafe:!X,variant:y.B.compact,cells:I.Bg,rows:Y||X||te?[{fullWidth:!0,cells:[{props:{colSpan:I.Bg.length+1},title:Y?a().createElement(M.Te,null):X?a().createElement(W.Z,null):a().createElement(M.VA,null)}]}]:ee?q:a().createElement(M.Te,null),sortBy:{index:N.sortIndex,direction:N.sortDirection},onSort:(e,t,r)=>{Q(!1),O({...N,sortIndex:t,sortDirection:r})},isStickyHeader:!0},a().createElement(k.x,null),a().createElement(w.R,null)),a().createElement(P.Pagination,{ouiaId:"pager",itemCount:F.length,page:N.offset/N.limit+1,perPage:Number(N.limit),onSetPage:(e,t)=>O({...N,offset:N.limit*(t-1)}),onPerPageSelect:(e,t)=>O({...N,limit:t,offset:0}),widgetId:"pagination-options-menu-bottom",variant:C.aM.bottom})))};O.propTypes={query:u().object.isRequired};const N=()=>{const e=(0,o.Oj)();return a().createElement(O,{query:e})};var B=r(77697),V=r(55140);const F=()=>{const e=(0,i.Z)();return(0,V.Z)().updateDocumentTitle(e.formatMessage(n.Z.documentTitle,{subnav:e.formatMessage(n.Z.clusters)})),a().createElement(a().Fragment,null,a().createElement(l.Z,{className:"ins-c-clusters-header"},a().createElement(B.Title,{headingLevel:"h1",ouiaId:"page-header"},`${e.formatMessage(n.Z.insightsHeader)} ${e.formatMessage(n.Z.clusters).toLowerCase()}`)),a().createElement("section",{className:"pf-l-page__main-section pf-c-page__main-section"},a().createElement(N,null)))}},57642:(e,t,r)=>{"use strict";r.d(t,{Lg:()=>f,Lv:()=>y,U1:()=>b,WL:()=>h,_:()=>g,_F:()=>u,aM:()=>p,im:()=>m,mt:()=>d,oo:()=>v,yG:()=>_});var s=r(48403),a=r.n(s),i=r(50361),l=r.n(i),n=(r(28416),r(81249)),o=r(81563),c=r(94608);const u=(e,t)=>Object.entries(t).every((([t,r])=>{switch(t){case"text":return e.description.toLowerCase().includes(r.toLowerCase());case o.W2.total_risk.urlParam:return r.includes(String(e.total_risk));case o.W2.category.urlParam:return e.tags.find((e=>r.includes(String(o.kT[e]))));case o.W2.impact.urlParam:return r.includes(String(e.impact));case o.W2.impacting.urlParam:return!(r.length>0)||r.some((t=>"true"===t?e.impacted_clusters_count>0:"false"===t?0===e.impacted_clusters_count:void 0));case o.W2.likelihood.urlParam:return r.includes(String(e.likelihood));case o.W2.rule_status.urlParam:return"all"===r||"disabled"===r&&e.disabled||"enabled"===r&&!e.disabled;case o.W2.res_risk.urlParam:return r.includes(String(e.resolution_risk));default:return!0}})),m=(e,t)=>Object.entries(t).every((([t,r])=>{switch(t){case"text":return(e.cluster_name||e.cluster_id).toLowerCase().includes(r.toLowerCase());case o.RT.hits.urlParam:return 0===r.length&&parseInt(e.total_hit_count)>0||r.includes("all")||r.some((t=>e.hits_by_total_risk[t]>0));case"version":return 0===r.length||r.includes(h(e.cluster_version));default:return!0}})),d=(e,t)=>{const r=l()(e);return delete r.sortIndex,delete r.sortDirection,delete r.sort,delete r.offset,delete r.limit,r?.hits&&0===r.hits.length&&delete r.hits,((e,t)=>Object.entries(e||{}).reduce(((e,r)=>{const[s,i]=r;if(t[s]){const r=t[s],l=Array.isArray(i)?i.map((e=>{const t=r.values.find((t=>t.value===String(e)));return t?{name:t.text||t.label,value:e}:{name:e,value:e}})):[{name:r.values.find((e=>e.value===String(i))).label,value:i}];return[...e,{category:a()(r.title),chips:l,urlParam:r.urlParam}]}return"text"===s?[...e,...i.length>0?[{category:"Name",chips:[{name:i,value:i}],urlParam:s}]:[]]:"version"===s?[...e,...i.length>0?[{category:"Version",chips:i.map((e=>({name:e,value:e}))),urlParam:s}]:[]]:"namespace_name"===s?[...e,...i.length>0?[{category:"Namespace name",chips:[{name:i,value:i}],urlParam:s}]:[]]:"cluster_name"===s?[...e,...i.length>0?[{category:"Cluster name",chips:[{name:i,value:i}],urlParam:s}]:[]]:void 0}),[]))(r,t)},_=e=>{const t=new URLSearchParams(e);return Array.from(t).reduce(((e,[t,r])=>({...e,[t]:["text","first","rule_status","sort","cluster_name","namespace_name","description","object_id"].includes(t)?r:"true"===r||"false"===r?JSON.parse(r):r.split(",")})),{})},f=e=>({name:e.substring(e.startsWith("-")?1:0),direction:e.startsWith("-")?"desc":"asc",description:e.substring(e.startsWith("-")?1:0),object_id:e.substring(e.startsWith("-")?1:0)}),p=(e={},t)=>{const r=new URL(window.location.origin+window.location.pathname);var s,a,i;r.searchParams.set("sort",(s=e.sortIndex,a=t,i=e.sortDirection,["desc","asc"].includes(i)||console.error("Invalid sort parameters (is not asc nor desc)"),`${"asc"===i?"":"-"}${a[s]}`)),Object.entries(e).forEach((([e,t])=>"sortIndex"!==e&&"sortDirection"!==e&&"sort"!==e&&""!==t&&!(Array.isArray(t)&&0===t.length)&&r.searchParams.set(e,t))),window.history.replaceState(null,null,r.href)},g=(e,t,r)=>r*(0,n.compare)(e,t),h=e=>(0,n.coerce)(void 0!==e&&(0,n.valid)((0,n.coerce)(e))?e:"0.0.0").version,v=(e,t,r)=>{const{[r]:s,...a}={...e,offset:0};t({...a,..."text"===r?{text:""}:"hits"===r?{hits:[]}:"version"===r?{version:[]}:"object_id"===r?{object_id:""}:{}})},y=(e,t,r,s)=>s.length>0?t({...e,offset:0,[r]:s}):v(e,t,r),b=(e,t)=>{const r=(0,c.Vs)(e.metadata.hits_by_severity,"general");return Object.entries(t).every((([s,a])=>{switch(s){case"cluster_name":return(e.cluster.display_name||e.cluster.uuid).toLowerCase().includes(a.toLowerCase());case"namespace_name":return(e.namespace.name||e.namespace.uuid).toLowerCase().includes(a.toLowerCase());case"severity":return 0===a.length||(0,c.mR)(r,t.severity);default:return!0}}))}},83920:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var s=r(28416),a=r.n(s),i=r(58009),l=r(24561);const n=()=>a().createElement(i.Card,{ouiaId:"loading-skeleton"},a().createElement(i.CardBody,null,a().createElement(l.aV,null)))},94608:(e,t,r)=>{"use strict";r.d(t,{Q$:()=>p,Vs:()=>l,ke:()=>_,l8:()=>f,lM:()=>m,mR:()=>n,p5:()=>g,sI:()=>h,wW:()=>o,y4:()=>v});var s=r(48585),a=r(44439),i=r.n(a);const l=(e,t)=>{const r={1:"low",2:"moderate",3:"important",4:"critical"};let s={};if("general"===t||"label"===t)for(const t in e)t in r&&(s[r[t]]=e[t]);else s=r[e];return s},n=(e,t)=>{for(const r of t)if(e[r]>0)return!0},o=e=>{const t=i().cloneDeep(e);return delete t.sortIndex,delete t.sortDirection,delete t.offset,delete t.limit,delete t.sort,!!Object.values(t).filter((e=>!i().isEmpty(e))).length},c=e=>e?.charAt(0).toUpperCase()+e?.slice(1),u=(e,t)=>{if(e.values){const r=e.values.find((e=>e.value===String(t)));return r?{name:r.label||r.text,value:t}:{name:t,value:t}}return{name:t,value:t}},m=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>{if(t[r]){const a=t[r];if(Array.isArray(s)&&s.length>0||"string"==typeof s&&""!==s.trim()){const t=Array.isArray(s)?s.map((e=>u(a,e))):[u(a,s)];e.push({category:c(a.label),chips:t,urlParam:a.urlParam})}}else"description"!==r&&"object_id"!==r||""===s.trim()||e.push({category:c(r.replace("_"," ")),chips:[{name:s,value:s}],urlParam:r});return e}),[]),d=(e,t)=>{const r=t[0].rule;switch(e){case 1:return r.details;case 2:return r.total_risk;case 3:return r.objects.length;case 4:return r.modified}},_=(e,t,r)=>e>=1?[...r]?.sort(((r,a)=>{const i=t===s.B.asc?1:-1;return d(e,r)>d(e,a)?i:d(e,a)>d(e,r)?-i:0})):[...r],f=(e,t)=>e.flatMap(((e,r)=>{const s=[...e];return t&&0===r&&(e[0].isOpen=!0),e[1].parent=2*r,s})),p=(e,t)=>Object.entries(t).some((([t,r])=>"object_id"===t&&e.uid.toLowerCase().includes(r.toLowerCase()))),g=(e,t,r)=>{const{[r]:s,...a}={...e};t({...a,..."description"===r?{description:""}:"total_risk"===r?{total_risk:[]}:"object_id"===r?{object_id:""}:{}})},h=(e,t,r,s)=>s.length>0?t({...e,[r]:s}):g(e,t,r),v=(e,t)=>{const r=i().omitBy(i().cloneDeep(t),i().isEmpty);return Object.entries(r).every((([t,r])=>{switch(t){case"description":return r&&e.details.toLowerCase().includes(r.toLowerCase());case"object_id":return r&&e.objects.some((e=>e.uid.toLowerCase().includes(r.toLowerCase())));case"total_risk":return r&&r.includes(String(e.total_risk));default:return!0}}))}},65088:()=>{},36150:()=>{},63498:()=>{},36213:()=>{},81235:()=>{},81754:()=>{},16506:()=>{},43109:()=>{},70347:()=>{},12796:()=>{},95594:()=>{},15622:()=>{},58392:()=>{},10497:()=>{},80598:()=>{},32857:()=>{},1580:()=>{},94498:()=>{},37625:()=>{},71644:()=>{},23055:()=>{},54476:()=>{},27567:()=>{},28992:()=>{},90146:()=>{},80897:()=>{},30187:()=>{},40837:()=>{},50311:()=>{},90479:()=>{},78752:()=>{},71338:()=>{},11080:()=>{},44839:()=>{},21626:()=>{},74282:()=>{},67274:()=>{},24620:()=>{},82014:()=>{},90776:()=>{},88277:()=>{},97939:()=>{},8572:()=>{},98379:()=>{},25238:()=>{},61612:()=>{},33858:()=>{},66213:()=>{},77350:()=>{},69076:()=>{},70150:()=>{},92084:()=>{},46928:()=>{},1508:()=>{},91993:()=>{},84958:()=>{},37739:()=>{},99624:()=>{},36974:()=>{},43919:()=>{},91027:()=>{},53336:()=>{},16061:()=>{},27479:()=>{},93661:()=>{},56024:()=>{},54994:()=>{},44690:()=>{},37494:()=>{},43390:()=>{},22143:()=>{},48223:()=>{},7064:()=>{},97853:()=>{},97236:()=>{},38024:()=>{},11489:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},51934:()=>{},72816:()=>{},74181:()=>{},16166:()=>{}}]);
//# sourceMappingURL=../sourcemaps/ClustersList.2ff2475616fb11c496b40e9cb2e161b0.js.map