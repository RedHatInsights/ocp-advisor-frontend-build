(self.webpackChunkocpAdvisor=self.webpackChunkocpAdvisor||[]).push([[9420,8299,4693,8024,9767],{99461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var a=r(28416),s=r.n(a),l=r(86896),i=r(63456),n=r(2550),o=r(11042),c=r(45697),u=r.n(c),m=r(86706),d=r(18446),p=r.n(d),f=r(56800),g=r(45578),_=r.n(g),h=r(81249),v=r(48585),y=r(75863),b=r(35981),w=r(49004),k=r(58027),C=r(94992),x=r(90766),L=r(8780),P=r(13877),E=r(90111),S=r.n(E),I=r(62410),j=r(77572),A=r(72668),T=r(81563),Z=r(57642),M=r(83920),W=r(91306),N=r(38654),R=r(33366),D=r(39403);const $=({query:{isError:e,isUninitialized:t,isFetching:r,isSuccess:i,data:o,refetch:c}})=>{const u=(0,D.ji)(),d=(0,l.Z)(),g=(0,m.useDispatch)(),E=e=>g((0,A.$Q)(e)),$=(0,m.useSelector)((({filters:e})=>e.clustersListState)),O=o?.data||[],B=$.offset/$.limit+1,[V,F]=(0,a.useState)([]),[U,q]=(0,a.useState)([]),[G,H]=(0,a.useState)(!1),[Q,z]=(0,a.useState)(!0),{search:J}=(0,f.useLocation)(),K=t||r||!G,X=e,Y=i,ee=O.length>0&&0===V?.length&&0===U?.length,te=(0,R.Vk)(),re=(e,t)=>(0,Z.Lv)($,E,e,t);(0,a.useEffect)((()=>{const e=new AbortController,t=e.signal;return(async()=>{H(!1);const e=await se(V,t);"cancel"!==e&&(q(e),H(!0))})(),()=>{e.abort()}}),[V,$.limit,$.offset,u]),(0,a.useEffect)((()=>{H(!1),F(ae(O))}),[o,$.text,$.version,$.hits,$.sortDirection,$.sortIndex]),(0,a.useEffect)((()=>{if(J&&Q){const e=(0,Z.yG)(J);if(e.sort){const t=(0,Z.Lg)(e.sort);e.sortIndex=T.lo.indexOf(t.name),e.sortDirection=t.direction}e.offset&&(e.offset=Number(e.offset[0])),e.limit&&(e.limit=Number(e.limit[0])),e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=[`${e.impacting}`]),E({...$,...e})}z(!1)}),[]),(0,a.useEffect)((()=>{Q||(0,Z.aM)($,T.lo)}),[$,Q]);const ae=e=>{const t=e.filter((e=>(0,Z.im)(e,$))).map((e=>({it:e,cells:[e.cluster_name||e.cluster_id,e.cluster_version,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,e.last_checked_at]})));return-1===$.sortIndex?t:t.sort(((e,t)=>{let r,a;const s=$.sortDirection===v.B.asc?1:-1;switch($.sortIndex){case T.v7:return r=e.it.cluster_name||e.it.cluster_id,a=t.it.cluster_name||t.it.cluster_id,r.localeCompare(a)?r.localeCompare(a)*s:0;case T._s:return(0,Z._)((0,Z.WL)(e.it.cluster_version),(0,Z.WL)(t.it.cluster_version),s);case T.CL:return r=new Date(e.it.last_checked_at||0),a=new Date(t.it.last_checked_at||0),r>a?s:a>r?-s:0;default:return r=e.cells[$.sortIndex],a=t.cells[$.sortIndex],r>a?s:a>r?-s:0}}))},se=async(e,t)=>{const r=e?.slice($.limit*(B-1),$.limit*(B-1)+$.limit),a=r?.map((e=>e.it.cluster_id));let l=[];if(a?.length>0&&u){let e=null;try{e=await te.post("/api/insights-results-aggregator/v2/upgrade-risks-prediction",{clusters:a},{signal:t})}catch(e){console.log(e)}if(void 0===e)return"cancel";"ok"===e?.status&&(l=e.predictions.map((e=>e)))}const i=r?.map((({it:e},t)=>{void 0===e.cluster_version||""===e.cluster_version||(0,h.valid)((0,h.coerce)(e.cluster_version))||console.error(`Cluster version ${e.cluster_version} has invalid format!`);const r=(0,Z.WL)(e.cluster_version),a=Array.isArray(l)&&!1===l.find((t=>t?.cluster_id===e?.cluster_id))?.upgrade_recommended;return{entity:e,cells:[s().createElement("span",{key:e.cluster_id,className:"pf-v5-l-flex"},s().createElement(f.Link,{key:`${e.cluster_id}-link`,to:`${N.G}/clusters/${e.cluster_id}`,className:"pf-v5-l-flex__item"},e.cluster_name||e.cluster_id),a&&s().createElement(C.Label,{isCompact:!0,color:"orange",className:"pf-v5-l-flex__item"},"Update risk")),"0.0.0"===r?d.formatMessage(n.Z.nA):r,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,s().createElement("span",{key:t},e.last_checked_at?s().createElement(I.Z,{extraTitle:`${d.formatMessage(n.Z.lastSeen)}: `,date:e.last_checked_at,variant:"relative"}):s().createElement(L.Tooltip,{key:t,content:s().createElement("span",null,d.formatMessage(n.Z.lastSeen)+": ",d.formatMessage(n.Z.nA))},s().createElement("span",null,d.formatMessage(n.Z.nA))))]}}));return i},le=[{label:d.formatMessage(n.Z.name).toLowerCase(),type:"text",filterValues:{key:"text-filter",onChange:(e,t)=>E({...$,offset:0,text:t}),value:$.text,placeholder:d.formatMessage(n.Z.filterByName)}},{label:d.formatMessage(n.Z.version),placeholder:d.formatMessage(n.Z.filterByVersion),type:j.conditionalFilterType.checkbox,filterValues:{id:"version-filter",key:"version-filter",onChange:(e,t)=>re("version",t),value:$.version,items:_()(O.filter((e=>void 0!==e.cluster_version&&""!==e.cluster_version)).map((e=>({label:e.cluster_version,value:(0,Z.WL)(e.cluster_version)}))).sort(((e,t)=>(0,Z._)((0,Z.WL)(e.cluster_version),(0,Z.WL)(t.cluster_version),1))).reverse(),"value")}},{label:T.RT.hits.title,type:T.RT.hits.type,id:T.RT.hits.urlParam,value:`checkbox-${T.RT.hits.urlParam}`,filterValues:{key:`${T.RT.hits.urlParam}-filter`,onChange:(e,t)=>re(T.RT.hits.urlParam,t),value:$.hits,items:T.RT.hits.values}}],ie={showDeleteButton:!0,deleteTitle:d.formatMessage(n.Z.resetFilters),filters:(0,Z.mt)($,T.RT),onDelete:(e,t,r)=>{r?p()($,A.Ly)?c():(0,A.aw)($,A.Ly,E):t.map((e=>{const t={[e.urlParam]:Array.isArray($[e.urlParam])?$[e.urlParam].filter((t=>String(t)!==String(e.chips[0].value))):""};var r;t[e.urlParam].length>0?E({...$,...t}):(r=e.urlParam,(0,Z.oo)($,E,r))}))}};return s().createElement(s().Fragment,null,i&&0===O.length?s().createElement(W.ER,null):s().createElement("div",{id:"clusters-list-table","data-ouia-safe":!K},s().createElement(S(),{pagination:{itemCount:V.length,page:B,perPage:$.limit,onSetPage:(e,t)=>(H(!1),E({...$,offset:$.limit*(t-1)})),onPerPageSelect:(e,t)=>(H(!1),E({...$,limit:t,offset:0})),isCompact:!0,ouiaId:"pager"},filterConfig:{items:le},activeFiltersConfig:ie}),s().createElement(b.i,{"aria-label":"Table of clusters",ouiaId:"clusters",ouiaSafe:!K,variant:y.B.compact,cells:T.Bg,rows:X||K||ee?[{fullWidth:!0,cells:[{props:{colSpan:T.Bg.length+1},title:X?s().createElement(W.Te,null):K?s().createElement(M.Z,null):s().createElement(W.VA,null)}]}]:Y?U:s().createElement(W.Te,null),sortBy:{index:$.sortIndex,direction:$.sortDirection},onSort:(e,t,r)=>{H(!1),E({...$,sortIndex:t,sortDirection:r})},isStickyHeader:!0},s().createElement(w.x,null),s().createElement(k.R,null)),s().createElement(x.Pagination,{ouiaId:"pager",itemCount:V.length,page:$.offset/$.limit+1,perPage:Number($.limit),onSetPage:(e,t)=>E({...$,offset:$.limit*(t-1)}),onPerPageSelect:(e,t)=>E({...$,limit:t,offset:0}),widgetId:"pagination-options-menu-bottom",variant:P.aM.bottom})))};$.propTypes={query:u().object.isRequired};const O=()=>{const e=(0,o.Oj)();return s().createElement($,{query:e})};var B=r(50318),V=r(55140);const F=()=>{const e=(0,l.Z)();return(0,V.Z)().updateDocumentTitle(e.formatMessage(n.Z.documentTitle,{subnav:e.formatMessage(n.Z.clusters)})),s().createElement(s().Fragment,null,s().createElement(i.Z,{className:"ins-c-clusters-header"},s().createElement(B.Title,{headingLevel:"h1",ouiaId:"page-header"},`${e.formatMessage(n.Z.insightsHeader)} ${e.formatMessage(n.Z.clusters).toLowerCase()}`)),s().createElement("section",{className:"pf-l-page__main-section pf-c-page__main-section"},s().createElement(O,null)))}},57642:(e,t,r)=>{"use strict";r.d(t,{Lg:()=>f,Lv:()=>y,U1:()=>b,WL:()=>h,_:()=>_,_F:()=>u,aM:()=>g,im:()=>m,mt:()=>d,oo:()=>v,yG:()=>p});var a=r(48403),s=r.n(a),l=r(50361),i=r.n(l),n=(r(28416),r(81249)),o=r(81563),c=r(94608);const u=(e,t)=>Object.entries(t).every((([t,r])=>{switch(t){case"text":return e.description.toLowerCase().includes(r.toLowerCase());case o.W2.total_risk.urlParam:return r.includes(String(e.total_risk));case o.W2.category.urlParam:return e.tags.find((e=>r.includes(String(o.kT[e]))));case o.W2.impact.urlParam:return r.includes(String(e.impact));case o.W2.impacting.urlParam:return!(r.length>0)||r.some((t=>"true"===t?e.impacted_clusters_count>0:"false"===t?0===e.impacted_clusters_count:void 0));case o.W2.likelihood.urlParam:return r.includes(String(e.likelihood));case o.W2.rule_status.urlParam:return"all"===r||"disabled"===r&&e.disabled||"enabled"===r&&!e.disabled;case o.W2.res_risk.urlParam:return r.includes(String(e.resolution_risk));default:return!0}})),m=(e,t)=>Object.entries(t).every((([t,r])=>{switch(t){case"text":return(e.cluster_name||e.cluster_id).toLowerCase().includes(r.toLowerCase());case o.RT.hits.urlParam:return 0===r.length&&parseInt(e.total_hit_count)>0||r.includes("all")||r.some((t=>e.hits_by_total_risk[t]>0));case"version":return 0===r.length||r.includes(h(e.cluster_version));default:return!0}})),d=(e,t)=>{const r=i()(e);return delete r.sortIndex,delete r.sortDirection,delete r.sort,delete r.offset,delete r.limit,r?.hits&&0===r.hits.length&&delete r.hits,((e,t)=>Object.entries(e||{}).reduce(((e,r)=>{const[a,l]=r;if(t[a]){const r=t[a],i=Array.isArray(l)?l.map((e=>{const t=r.values.find((t=>t.value===String(e)));return t?{name:t.text||t.label,value:e}:{name:e,value:e}})):[{name:r.values.find((e=>e.value===String(l))).label,value:l}];return[...e,{category:s()(r.title),chips:i,urlParam:r.urlParam}]}return"text"===a?[...e,...l.length>0?[{category:"Name",chips:[{name:l,value:l}],urlParam:a}]:[]]:"version"===a?[...e,...l.length>0?[{category:"Version",chips:l.map((e=>({name:e,value:e}))),urlParam:a}]:[]]:"namespace_name"===a?[...e,...l.length>0?[{category:"Namespace name",chips:[{name:l,value:l}],urlParam:a}]:[]]:"cluster_name"===a?[...e,...l.length>0?[{category:"Cluster name",chips:[{name:l,value:l}],urlParam:a}]:[]]:void 0}),[]))(r,t)},p=e=>{const t=new URLSearchParams(e);return Array.from(t).reduce(((e,[t,r])=>({...e,[t]:["text","first","rule_status","sort","cluster_name","namespace_name","description","object_id"].includes(t)?r:"true"===r||"false"===r?JSON.parse(r):r.split(",")})),{})},f=e=>({name:e.substring(e.startsWith("-")?1:0),direction:e.startsWith("-")?"desc":"asc",description:e.substring(e.startsWith("-")?1:0),object_id:e.substring(e.startsWith("-")?1:0)}),g=(e={},t)=>{const r=new URL(window.location.origin+window.location.pathname);var a,s,l;r.searchParams.set("sort",(a=e.sortIndex,s=t,l=e.sortDirection,["desc","asc"].includes(l)||console.error("Invalid sort parameters (is not asc nor desc)"),`${"asc"===l?"":"-"}${s[a]}`)),Object.entries(e).forEach((([e,t])=>"sortIndex"!==e&&"sortDirection"!==e&&"sort"!==e&&""!==t&&!(Array.isArray(t)&&0===t.length)&&r.searchParams.set(e,t))),window.history.replaceState(null,null,r.href)},_=(e,t,r)=>r*(0,n.compare)(e,t),h=e=>(0,n.coerce)(void 0!==e&&(0,n.valid)((0,n.coerce)(e))?e:"0.0.0").version,v=(e,t,r)=>{const{[r]:a,...s}={...e,offset:0};t({...s,..."text"===r?{text:""}:"hits"===r?{hits:[]}:"version"===r?{version:[]}:"object_id"===r?{object_id:""}:{}})},y=(e,t,r,a)=>a.length>0?t({...e,offset:0,[r]:a}):v(e,t,r),b=(e,t)=>{const r=(0,c.Vs)(e.metadata.hits_by_severity,"general");return Object.entries(t).every((([a,s])=>{switch(a){case"cluster_name":return(e.cluster.display_name||e.cluster.uuid).toLowerCase().includes(s.toLowerCase());case"namespace_name":return(e.namespace.name||e.namespace.uuid).toLowerCase().includes(s.toLowerCase());case"severity":return 0===s.length||(0,c.mR)(r,t.severity);default:return!0}}))}},83920:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(28416),s=r.n(a),l=r(67073),i=r(24561);const n=()=>s().createElement(l.Card,{ouiaId:"loading-skeleton"},s().createElement(l.CardBody,null,s().createElement(i.aV,null)))},94608:(e,t,r)=>{"use strict";r.d(t,{Q$:()=>b,Vs:()=>m,ke:()=>v,l8:()=>y,lM:()=>_,mR:()=>d,og:()=>u,p5:()=>w,sI:()=>k,wW:()=>p,y4:()=>C});var a=r(48585),s=r(14176),l=r.n(s),i=r(50361),n=r.n(i),o=r(41609),c=r.n(o);const u=[{value:"critical",label:"Critical",iconColor:"var(--pf-global--danger-color--100)",textColor:"var(--pf-global--danger-color--100)",hasIcon:!0,indexNumber:4},{value:"important",label:"Important",iconColor:"var(--pf-global--palette--orange-300)",textColor:"var(--pf-global--palette--orange-400)",hasIcon:!0,indexNumber:3},{value:"moderate",label:"Moderate",iconColor:"var(--pf-global--warning-color--100)",textColor:"var(--pf-global--warning-color--200)",hasIcon:!0,indexNumber:2},{value:"low",label:"Low",iconColor:"var(--pf-global--Color--200)",textColor:"var(--pf-global--default-color--300)",hasIcon:!0,indexNumber:1}],m=(e,t)=>{const r={1:"low",2:"moderate",3:"important",4:"critical"};let a={};if("general"===t||"label"===t)for(const t in e)t in r&&(a[r[t]]=e[t]);else a=r[e];return a},d=(e,t)=>{for(const r of t)if(e[r]>0)return!0},p=e=>{const t=n()(e);return delete t.sortIndex,delete t.sortDirection,delete t.offset,delete t.limit,delete t.sort,!!Object.values(t).filter((e=>!c()(e))).length},f=e=>e?.charAt(0).toUpperCase()+e?.slice(1),g=(e,t)=>{if(e.values){const r=e.values.find((e=>e.value===String(t)));return r?{name:r.label||r.text,value:t}:{name:t,value:t}}return{name:t,value:t}},_=(e,t)=>Object.entries(e).reduce(((e,[r,a])=>{if(t[r]){const s=t[r];if(Array.isArray(a)&&a.length>0||"string"==typeof a&&""!==a.trim()){const t=Array.isArray(a)?a.map((e=>g(s,e))):[g(s,a)];e.push({category:f(s.label),chips:t,urlParam:s.urlParam})}}else"display_name"===r&&""!==a.trim()?e.push({category:f(r.replace("display_name","Name")),chips:[{name:a,value:a}],urlParam:"display_name"}):"description"!==r&&"object_id"!==r||""===a.trim()||e.push({category:f(r.replace("_"," ")),chips:[{name:a,value:a}],urlParam:r});return e}),[]),h=(e,t)=>{const r=t[0].rule;switch(e){case 1:return r.details;case 2:return r.total_risk;case 3:return r.objects.length;case 4:return r.modified}},v=(e,t,r)=>e>=1?[...r]?.sort(((r,s)=>{const l=t===a.B.asc?1:-1;return h(e,r)>h(e,s)?l:h(e,s)>h(e,r)?-l:0})):[...r],y=(e,t)=>e.flatMap(((e,r)=>{const a=[...e];return t&&0===r&&(e[0].isOpen=!0),e[1].parent=2*r,a})),b=(e,t)=>{const r=l()(n()(t),c());return Object.entries(r).every((([t,r])=>{switch(t){case"display_name":return r&&e?.display_name?.toLowerCase().includes(r.toLowerCase());case"object_id":return r&&e?.uid?.toLowerCase().includes(r.toLowerCase());default:return!0}}))},w=(e,t,r)=>{const{[r]:a,...s}={...e};t({...s,..."description"===r?{description:""}:"total_risk"===r?{total_risk:[]}:"object_id"===r?{object_id:""}:{}})},k=(e,t,r,a)=>a.length>0?t({...e,[r]:a}):w(e,t,r),C=(e,t)=>{const r=l()(n()(t),c());return Object.entries(r).every((([t,r])=>{switch(t){case"description":return r&&e.details.toLowerCase().includes(r.toLowerCase());case"object_id":return r&&e.objects.some((e=>e.uid.toLowerCase().includes(r.toLowerCase())));case"total_risk":return r&&r.includes(String(e.total_risk));default:return!0}}))}},65088:()=>{},36150:()=>{},63498:()=>{},36213:()=>{},81235:()=>{},81754:()=>{},16506:()=>{},43109:()=>{},70347:()=>{},12796:()=>{},95594:()=>{},15622:()=>{},58392:()=>{},10497:()=>{},80598:()=>{},32857:()=>{},1580:()=>{},94498:()=>{},37625:()=>{},71644:()=>{},23055:()=>{},54476:()=>{},27567:()=>{},28992:()=>{},90146:()=>{},80897:()=>{},30187:()=>{},40837:()=>{},50311:()=>{},90479:()=>{},78752:()=>{},71338:()=>{},11080:()=>{},44839:()=>{},21626:()=>{},74282:()=>{},67274:()=>{},24620:()=>{},82014:()=>{},90776:()=>{},88277:()=>{},97939:()=>{},8572:()=>{},98379:()=>{},25238:()=>{},61612:()=>{},33858:()=>{},66213:()=>{},77350:()=>{},69076:()=>{},70150:()=>{},92084:()=>{},46928:()=>{},1508:()=>{},91993:()=>{},84958:()=>{},37739:()=>{},99624:()=>{},36974:()=>{},43919:()=>{},91027:()=>{},53336:()=>{},16061:()=>{},27479:()=>{},93661:()=>{},56024:()=>{},54994:()=>{},44690:()=>{},37494:()=>{},43390:()=>{},22143:()=>{},48223:()=>{},7064:()=>{},97853:()=>{},97236:()=>{},38024:()=>{},11489:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},51934:()=>{},72816:()=>{},74181:()=>{},16166:()=>{}}]);
//# sourceMappingURL=../sourcemaps/ClustersList.55324b83d037cbe8d95d1169ecad2779.js.map