"use strict";(self.webpackChunkocp_advisor_frontend=self.webpackChunkocp_advisor_frontend||[]).push([[987],{26553:(e,t,n)=>{n.r(t),n.d(t,{default:()=>pe});var a=n(93264),r=n.n(a),l=n(16530),s=n(86896),i=n(15861),c=n(29439),o=n(87757),u=n.n(o),d=n(88931),m=n(45697),f=n.n(m),p=n(56161),g=n(48716),h=n(39173),b=n(86350),v=n(62410),E=n(23218),Z=n(34348),y=n(71369),k=n(84785),M=n(96466),I=n(71355),C=n(6202),_=n(22910),w=n(96823),D=n(80765),S=n(36001),F=n(42057),O=n(43846),P=n(56276),x=n(90670),T=n(59303),j=n(30893),R=n(98042),N=n(52661),B=n(48622),q=n(51957),L=n(4942),A=n(77572),z=n(48114),W=n(92223),H=n(32875),U=n(97530),V=n(17335),G=n(12321),J=n(76),X=n(8045),Y=n(13877),K=n(51014),Q=n(28672),$=n(73451);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){(0,L.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=function(e){var t=e.query,n=e.rule,i=e.afterDisableFn,o=(0,s.Z)(),u=(0,d.useDispatch)(),m=(0,a.useState)([]),f=(0,c.Z)(m,2),g=f[0],h=f[1],b=(0,a.useState)([]),E=(0,c.Z)(b,2),Z=E[0],y=E[1],k=(0,a.useState)(!1),M=(0,c.Z)(k,2),I=M[0],C=M[1],_=(0,a.useState)([]),w=(0,c.Z)(_,2),D=w[0],S=w[1],F=(0,a.useState)([]),O=(0,c.Z)(F,2),P=O[0],x=O[1],R=(0,a.useState)(void 0),B=(0,c.Z)(R,2),q=B[0],L=B[1],ee=t.isError,ne=t.isUninitialized,ae=t.isFetching,re=t.isSuccess,le=t.data,se=(void 0===le?{disabled:[],enabled:[]}:le).enabled,ie=(0,d.useSelector)((function(e){return e.filters.affectedClustersState})),ce=ie.limit,oe=ie.offset/ie.limit+1,ue=P.length===g.length,de=function(e){return u((0,Q.BC)(e))},me={items:[{label:"Name",placeholder:"Filter by name",type:A.Yu.text,filterValues:{id:"name-filter",key:"name-filter",onChange:function(e,t){return function(e){var t=te(te({},ie),{},{text:e,offset:0});de(t)}(t)},value:ie.text}}],isDisabled:ee||se&&0===se.length},fe=function(e,t){var n=t*ie.limit-ie.limit;de(te(te({},ie),{},{offset:n}))},pe=function(e,t){de(te(te({},ie),{},{limit:t}))},ge=function(e){return e.slice(ce*(oe-1),ce*(oe-1)+ce).map((function(e){return te(te({},e),{},{cells:[r().createElement("span",{key:e.id},r().createElement(l.Link,{to:"/clusters/".concat(e.id,"?first=").concat(n.rule_id)},e.cells[0])),r().createElement("span",{key:e.id},e.last_checked_at?r().createElement(v.Z,{extraTitle:"".concat(o.formatMessage(j.Z.lastSeen),": "),date:e.last_checked_at,variant:"relative"}):r().createElement(X.Tooltip,{key:e.id,content:r().createElement("span",null,o.formatMessage(j.Z.lastSeen)+": ",o.formatMessage(j.Z.nA))},r().createElement("span",null,o.formatMessage(j.Z.nA))))]})}))},he=function(e,t,n){var a;a=-1===n?g.map((function(e){return te(te({},e),{},{selected:t})})):g.map((function(e,a){return te(te({},e),{},{selected:a===n?t:e.selected})})),x(a.filter((function(e){return e.selected}))),h(a),y(ge(a))};(0,a.useEffect)((function(){var e=function(e,t){return e.map((function(e){return{id:e.cluster,cells:[(null==e?void 0:e.cluster_name)||e.cluster],last_checked_at:null==e?void 0:e.last_checked_at}})).filter((function(e){return null==e?void 0:e.cells[0].toLowerCase().includes(t.text.toLowerCase())})).sort((function(e,n){var a,r,l="asc"===t.sortDirection?1:-1;switch(t.sortIndex){case T.XS:return"asc"===t.sortDirection?null==e?void 0:e.cells[0].localeCompare(null==n?void 0:n.cells[0]):null==n?void 0:n.cells[0].localeCompare(null==e?void 0:e.cells[0]);case T.UG:return(a=new Date(e.last_checked_at||0))>(r=new Date(n.last_checked_at||0))?l:r>a?-l:0}}))}(se,ie),t=ge(e),n=function(e,t){var n=e,a=n.findIndex((function(e){return"Name"===e.category}));return""===t?n.splice(a):-1===a?n.push({category:"Name",chips:[{name:t}]}):n[a]={category:"Name",chips:[{name:t}]},n}(D,ie.text);h(e),y(t),S(n)}),[t,ie]);var be=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;C(e),L(t)};return r().createElement("div",{id:"affected-list-table"},I&&r().createElement($.Z,{handleModalToggle:be,isModalOpen:I,rule:n,afterFn:i,hosts:P,host:q}),r().createElement(z.Z,{filterConfig:me,pagination:{itemCount:g.length,page:oe,perPage:ce,onSetPage:fe,onPerPageSelect:pe,ouiaId:"pager"},activeFiltersConfig:ee||se&&0===se.length?void 0:{filters:D,onDelete:function(){var e=te(te({},ie),{},{text:""});de(e)}},bulkSelect:{count:P.length,items:[{title:o.formatMessage(j.Z.selectNone),onClick:function(e){return he(0,!1,-1)}},{title:o.formatMessage(j.Z.selectAll,{items:(null==g?void 0:g.length)||0}),onClick:function(e){return he(0,!0,-1)}}],checked:ue,onSelect:function(e){return he(0,!ue,-1)},ouiaId:"clusters-selector"},actionsConfig:{actions:["",{label:o.formatMessage(j.Z.disableRuleForClusters),props:{isDisabled:0===P.length},onClick:function(){return be(!0)}}]}}),r().createElement(U.i,{"aria-label":"Table of affected clusters",ouiaId:"clusters",variant:"compact",cells:T.I9,rows:Z,sortBy:{index:ie.sortIndex,direction:ie.sortDirection},onSort:function(e,t,n){de(te(te({},ie),{},{sortIndex:t,sortDirection:n}))},canSelectAll:!1,onSelect:(null==Z?void 0:Z.length)>0?he:void 0,actions:[{title:"Disable recommendation for cluster",onClick:function(e,t){return be(!0,g[t].id)}}]},r().createElement(G.x,null),(ne||ae)&&r().createElement(N.Z,null),ee&&r().createElement(p.Card,{id:"error-state-message",ouiaId:"error-state"},r().createElement(p.CardBody,null,r().createElement(K.Te,null))),re&&0===se.length&&r().createElement(p.Card,{id:"empty-state-message",ouiaId:"empty-state"},r().createElement(p.CardBody,null,r().createElement(K.mi,null))),re&&se.length>0&&(g.length>0?r().createElement(V.R,null):r().createElement(W.Z,null,r().createElement(J.Bullseye,null,r().createElement(K.VA,null))))),r().createElement(H.Z,{isFooter:!0,className:"ins-c-inventory__table--toolbar"},r().createElement(Y.Pagination,{variant:Y.PaginationVariant.bottom,itemCount:g.length,page:oe,perPage:ce,onSetPage:fe,onPerPageSelect:pe,onPageInput:fe,ouiaId:"pager"})))};ne.propTypes={query:f().shape({isError:f().bool.isRequired,isUninitialized:f().bool.isRequired,isFetching:f().bool.isRequired,isSuccess:f().bool.isRequired,data:f().array}),rule:f().object,afterDisableFn:f().func};var ae=n(71094),re=n(86362),le=n(24561),se=n(30097),ie=n(78826),ce=n(6234),oe=n(77647),ue=function(e){var t=e.handleModalToggle,n=e.isModalOpen,l=e.clusters,o=e.recId,m=e.afterFn,f=(0,s.Z)(),p=(0,d.useDispatch)(),g=function(e){return p((0,I.wN)(e))},h=l.data,b=l.isFetching,E=l.isLoading,Z=l.refetch,y=(null==h?void 0:h.disabled)||[],k=(0,a.useState)([]),M=(0,c.Z)(k,2),_=M[0],w=M[1],D=(0,a.useState)(!1),S=(0,c.Z)(D,2),F=S[0],O=S[1],P=[{title:f.formatMessage(j.Z.clusterName),transforms:[(0,se.cellWidth)(50)]},{title:f.formatMessage(j.Z.justificationNote),transforms:[(0,se.cellWidth)(25)]},{title:f.formatMessage(j.Z.dateDisabled),transforms:[(0,se.cellWidth)(15)]},""],x=function(){var e=(0,i.Z)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,oe.o1)({uuid:n.cluster_id,recId:o});case 3:Z(),O(!0),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),t(!1),g({variant:"danger",dismissable:!0,title:f.formatMessage(j.Z.error),description:"".concat(e.t0)});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e=null==y?void 0:y.map((function(e){return{cells:[e.cluster_name||e.cluster_id,e.justification||f.formatMessage(j.Z.none),{title:r().createElement(v.Z,{date:new Date(e.disabled_at),type:"onlyDate"})},{title:r().createElement(C.Button,{key:e.cluster_id,isInline:!0,variant:"link",onClick:function(){return x(e)}},r().createElement(ce.ZP,{size:"sm"})," ".concat(f.formatMessage(j.Z.enable)))}]}}));E||0!==y.length||(m(),t(!1)),w(e)}),[y]),r().createElement(ie.u_,{width:"75%",title:f.formatMessage(j.Z.hostAckModalTitle),isOpen:n,onClose:function(){F&&m(),t(!1)}},b?r().createElement(se.Table,{"aria-label":"host-ack-table",rows:[{cells:[{props:{colSpan:3},title:r().createElement(le.aV,null)}]}],cells:P},r().createElement(se.TableHeader,null),r().createElement(se.TableBody,null)):r().createElement(se.Table,{"aria-label":"host-ack-table",rows:_,cells:P},r().createElement(se.TableHeader,null),r().createElement(se.TableBody,null)))};ue.propTypes={isModalOpen:f().bool,handleModalToggle:f().func,clusters:f().object,recId:f().string,afterFn:f().func},ue.defaultProps={isModalOpen:!1,handleModalToggle:function(){},clusters:{},recId:"",afterFn:function(){}};const de=ue;var me=n(73845),fe=function(e){var t=e.rule,n=e.ack,l=e.clusters,o=e.match,m=(0,s.Z)(),f=(0,d.useDispatch)(),L=function(e){return f((0,I.wN)(e))},A=o.params.recommendationId,z=(0,a.useState)(!1),W=(0,c.Z)(z,2),H=W[0],U=W[1],V=(0,a.useState)(!1),G=(0,c.Z)(V,2),J=G[0],X=G[1],Y=(0,a.useState)(!1),K=(0,c.Z)(Y,2),Q=K[0],ee=K[1],te=t.isError,le=t.isUninitialized,se=t.isLoading,ie=t.isFetching,ce=t.isSuccess,ue=t.data,fe=t.refetch,pe=n.data,ge=n.isFetching,he=n.refetch,be=new Date((null==pe?void 0:pe.updated_at)||(null==pe?void 0:pe.created_at)),ve=l.data,Ee=l.isFetching,Ze=l.refetch,ye=ce&&ue?(0,B.hw)(ue.content,A):void 0,ke=!Ee&&ve?ve.disabled:void 0,Me=function(){var e=(0,i.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe(),he(),Ze();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(e){U(e)},Ce=function(){var e=(0,i.Z)(u().mark((function e(t){var n,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uuids,e.prev=1,a=n.map((function(e){return(0,oe.o1)({uuid:e,recId:A})})),e.next=5,Promise.all(a);case 5:fe(),he(),Ze(),L({variant:"success",timeout:!0,dismissable:!0,title:m.formatMessage(j.Z.recSuccessfullyEnabledForCluster)}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),L({variant:"danger",dismissable:!0,title:m.formatMessage(j.Z.error),description:"".concat(e.t0)});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),_e=function(){var e=(0,i.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,ae.HG)("".concat(re._n,"/v2/ack/").concat(t.data.content.rule_id,"/"));case 3:L({variant:"success",timeout:!0,dismissable:!0,title:m.formatMessage(j.Z.recSuccessfullyEnabled)}),fe(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),Ie(!1),L({variant:"danger",dismissable:!0,title:m.formatMessage(j.Z.error),description:"".concat(e.t0)});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return r().createElement(r().Fragment,null,Q&&r().createElement(de,{handleModalToggle:function(e){return ee(e)},isModalOpen:Q,clusters:l,afterFn:function(){return Ze()},recId:A}),H&&r().createElement($.Z,{handleModalToggle:Ie,isModalOpen:H,rule:ye,afterFn:Me}),r().createElement(g.Z,{className:"pageHeaderOverride"},r().createElement(P.Z,{current:(null==ye?void 0:ye.description)||A})),(le||se||ie)&&r().createElement(b.Z,null,r().createElement(N.Z,null)),te&&r().createElement(b.Z,null,r().createElement(O.Z,null)),!(le||se||ie)&&ce&&r().createElement(r().Fragment,null,r().createElement(b.Z,{className:"pf-m-light pf-u-pt-sm"},r().createElement(R.Z,{isOpenShift:!0,isDetailsPage:!0,rule:ye,header:r().createElement(r().Fragment,null,r().createElement(h.Z,{title:r().createElement(r().Fragment,null,ye.description," ",r().createElement(x.Z,{rule:ye}))}),r().createElement("p",null,m.formatMessage(j.Z.rulesDetailsPubishdate,{date:r().createElement(v.Z,{date:new Date(ye.publish_date),type:"onlyDate"})}),ye.tags&&(Array.isArray(ye.tags)?r().createElement(y.LabelGroup,{className:"categoryLabels",numLabels:1,isCompact:!0},ye.tags.reduce((function(e,t){return T.kT[t]&&e.push(r().createElement(E.Label,{key:"label-".concat(t),color:"blue",isCompact:!0},T.W2.category.values[T.kT[t]-1].label)),e}),[])):r().createElement(E.Label,{isCompact:!0},ye.tags)))),onFeedbackChanged:function(){var e=(0,i.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ae.SO)("".concat(re._n,"/v2/rating"),{},{rule:t,rating:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},r().createElement(S.k,null,r().createElement(F.B,{align:{default:"alignRight"}},r().createElement(_.Dropdown,{className:"ins-c-rec-details__actions_dropdown",onSelect:function(){return X(!J)},position:"right",ouiaId:"actions",toggle:r().createElement(D.DropdownToggle,{onToggle:function(e){return X(e)},toggleIndicator:M.default},m.formatMessage(j.Z.actions)),isOpen:J,dropdownItems:null!=ye&&ye.disabled?[r().createElement(w.DropdownItem,{key:"link",ouiaId:"enable",onClick:function(){_e(t)}},m.formatMessage(j.Z.enableRule))]:[r().createElement(w.DropdownItem,{key:"link",ouiaId:"disable",onClick:function(){Ie(!0)}},m.formatMessage(j.Z.disableRule))]}))))),r().createElement(b.Z,null,r().createElement(r().Fragment,null,((null==ye?void 0:ye.hosts_acked_count)||(null==ke?void 0:ke.length)>0||(null==ye?void 0:ye.disabled))&&r().createElement(p.Card,{className:"cardOverride"},r().createElement(p.CardHeader,null,r().createElement(Z.Title,{headingLevel:"h4",size:"xl"},r().createElement(k.ZP,{size:"sm"})," ",m.formatMessage(!(null!=ye&&ye.hosts_acked_count||(null==ke?void 0:ke.length)>0)||null!=ye&&ye.disabled?j.Z.ruleIsDisabled:j.Z.ruleIsDisabledForClusters))),r().createElement(p.CardBody,null,!(null!=ye&&ye.hosts_acked_count||(null==ke?void 0:ke.length)>0)||null!=ye&&ye.disabled?!ge&&pe&&r().createElement(r().Fragment,null,null!=pe&&pe.justification?m.formatMessage(j.Z.ruleIsDisabledWithJustificaiton,{date:r().createElement("span",null,r().createElement(v.Z,{date:be,type:"onlyDate"})),reason:pe.justification}):m.formatMessage(j.Z.ruleIsDisabledWithoutJustificaiton,{date:r().createElement("span",null,r().createElement(v.Z,{date:be,type:"onlyDate"}))})):r().createElement(r().Fragment,null,m.formatMessage(j.Z.ruleIsDisabledForClustersBody,{clusters:null==ke?void 0:ke.length}),!Ee&&(null==ke?void 0:ke.length)>0?r().createElement(r().Fragment,null," ",r().createElement(C.Button,{isInline:!0,variant:"link",onClick:function(){return ee(!0)},ouiaId:"view-clusters"},m.formatMessage(j.Z.viewClusters))):r().createElement(me.F,null))),r().createElement(p.CardFooter,null,!(null!=ye&&ye.hosts_acked_count||(null==ke?void 0:ke.length)>0)||null!=ye&&ye.disabled?r().createElement(C.Button,{isInline:!0,variant:"link",onClick:function(){return _e(t)},ouiaId:"rule"},m.formatMessage(j.Z.enableRule)):!Ee&&ke?r().createElement(C.Button,{isInline:!0,variant:"link",onClick:function(){return Ce({uuids:ke.map((function(e){return e.cluster_id}))})},ouiaId:"enable-all"},m.formatMessage(j.Z.enableRuleForClusters)):r().createElement(me.F,null))),!(null!=ye&&ye.disabled)&&r().createElement(r().Fragment,null,r().createElement(Z.Title,{className:"titleOverride",headingLevel:"h3",size:"2xl"},m.formatMessage(j.Z.affectedClusters)),r().createElement(ne,{query:l,rule:ye,afterDisableFn:Me})),(null==ye?void 0:ye.disabled)&&r().createElement(q.Z,{icon:k.ZP,title:m.formatMessage(j.Z.ruleIsDisabled),text:m.formatMessage(j.Z.ruleIsDisabledBody)})))))};fe.propTypes={rule:f().object.isRequired,ack:f().object.isRequired,clusters:f().object.isRequired,match:f().object.isRequired};const pe=function(){var e,t,n=(0,s.Z)(),i=(0,re.qv)((0,l.useParams)().recommendationId),c=(0,oe.yr)({ruleId:(0,l.useParams)().recommendationId});if(i.isSuccess&&null!==(e=i.data)&&void 0!==e&&null!==(t=e.content)&&void 0!==t&&t.description){var o="".concat(i.data.content.description," - Recommendations");document.title=n.formatMessage(j.Z.documentTitle,{subnav:o})}var u=(0,re.tf)((0,l.useParams)().recommendationId);return(0,a.useEffect)((function(){i.refetch()}),[(0,l.useParams)().recommendationId]),r().createElement(fe,{rule:i,ack:c,clusters:u,match:(0,l.useRouteMatch)()})}}}]);
//# sourceMappingURL=../sourcemaps/Recommendation.c27cd1c6449f29077570e88c4076a845.js.map