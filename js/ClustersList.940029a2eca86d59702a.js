(self.webpackChunkocpAdvisor=self.webpackChunkocpAdvisor||[]).push([[9420,8299,4693,8024,9767],{99461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var s=r(28416),a=r.n(s),i=r(86896),n=r(63456),l=r(2550),o=r(11042),c=r(45697),u=r.n(c),m=r(86706),d=r(18446),_=r.n(d),f=r(56800),p=r(45578),h=r.n(p),g=r(81249),v=r(48585),y=r(75863),b=r(35981),k=r(49004),w=r(58027),L=r(94992),P=r(90766),C=r(8780),E=r(13877),x=r(90111),S=r.n(x),j=r(62410),A=r(77572),I=r(72668),T=r(81563),Z=r(57642),W=r(83920),M=r(91306),R=r(38654),D=r(33366),$=r(39403);const N=({query:{isError:e,isUninitialized:t,isFetching:r,isSuccess:n,data:o,refetch:c}})=>{const u=(0,$.ji)(),d=(0,i.Z)(),p=(0,m.useDispatch)(),x=e=>p((0,I.$Q)(e)),N=(0,m.useSelector)((({filters:e})=>e.clustersListState)),O=o?.data||[],B=N.offset/N.limit+1,[V,F]=(0,s.useState)([]),[U,q]=(0,s.useState)([]),[G,H]=(0,s.useState)(!1),[Q,z]=(0,s.useState)(!0),{search:J}=(0,f.useLocation)(),K=t||r||!G,X=e,Y=n,ee=O.length>0&&0===V?.length&&0===U?.length,te=(0,D.Vk)(),re=(e,t)=>(0,Z.Lv)(N,x,e,t);(0,s.useEffect)((()=>{const e=new AbortController,t=e.signal;return(async()=>{H(!1);const e=await ae(V,t);"cancel"!==e&&(q(e),H(!0))})(),()=>{e.abort()}}),[V,N.limit,N.offset,u]),(0,s.useEffect)((()=>{H(!1),F(se(O))}),[o,N.text,N.version,N.hits,N.sortDirection,N.sortIndex]),(0,s.useEffect)((()=>{if(J&&Q){const e=(0,Z.yG)(J);if(e.sort){const t=(0,Z.Lg)(e.sort);e.sortIndex=T.lo.indexOf(t.name),e.sortDirection=t.direction}e.offset&&(e.offset=Number(e.offset[0])),e.limit&&(e.limit=Number(e.limit[0])),e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=[`${e.impacting}`]),x({...N,...e})}z(!1)}),[]),(0,s.useEffect)((()=>{Q||(0,Z.aM)(N,T.lo)}),[N,Q]);const se=e=>{const t=e.filter((e=>(0,Z.im)(e,N))).map((e=>({it:e,cells:[e.cluster_name||e.cluster_id,e.cluster_version,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,e.last_checked_at]})));return-1===N.sortIndex?t:t.sort(((e,t)=>{let r,s;const a=N.sortDirection===v.B.asc?1:-1;switch(N.sortIndex){case T.v7:return r=e.it.cluster_name||e.it.cluster_id,s=t.it.cluster_name||t.it.cluster_id,r.localeCompare(s)?r.localeCompare(s)*a:0;case T._s:return(0,Z._)((0,Z.WL)(e.it.cluster_version),(0,Z.WL)(t.it.cluster_version),a);case T.CL:return r=new Date(e.it.last_checked_at||0),s=new Date(t.it.last_checked_at||0),r>s?a:s>r?-a:0;default:return r=e.cells[N.sortIndex],s=t.cells[N.sortIndex],r>s?a:s>r?-a:0}}))},ae=async(e,t)=>{const r=e?.slice(N.limit*(B-1),N.limit*(B-1)+N.limit),s=r?.map((e=>e.it.cluster_id));let i=[];if(s?.length>0&&u){let e=null;try{e=await te.post("/api/insights-results-aggregator/v2/upgrade-risks-prediction",{clusters:s},{signal:t})}catch(e){console.log(e)}if(void 0===e)return"cancel";"ok"===e?.status&&(i=e.predictions.map((e=>e)))}const n=r?.map((({it:e},t)=>{void 0===e.cluster_version||""===e.cluster_version||(0,g.valid)((0,g.coerce)(e.cluster_version))||console.error(`Cluster version ${e.cluster_version} has invalid format!`);const r=(0,Z.WL)(e.cluster_version),s=Array.isArray(i)&&!1===i.find((t=>t?.cluster_id===e?.cluster_id))?.upgrade_recommended;return{entity:e,cells:[a().createElement("span",{key:e.cluster_id,className:"pf-v5-l-flex"},a().createElement(f.Link,{key:`${e.cluster_id}-link`,to:`${R.G}/clusters/${e.cluster_id}`,className:"pf-v5-l-flex__item"},e.cluster_name||e.cluster_id),s&&a().createElement(L.Label,{isCompact:!0,color:"orange",className:"pf-v5-l-flex__item"},"Update risk")),"0.0.0"===r?d.formatMessage(l.Z.nA):r,e.total_hit_count,e.hits_by_total_risk?.[4]||0,e.hits_by_total_risk?.[3]||0,e.hits_by_total_risk?.[2]||0,e.hits_by_total_risk?.[1]||0,a().createElement("span",{key:t},e.last_checked_at?a().createElement(j.Z,{extraTitle:`${d.formatMessage(l.Z.lastSeen)}: `,date:e.last_checked_at,variant:"relative"}):a().createElement(C.Tooltip,{key:t,content:a().createElement("span",null,d.formatMessage(l.Z.lastSeen)+": ",d.formatMessage(l.Z.nA))},a().createElement("span",null,d.formatMessage(l.Z.nA))))]}}));return n},ie=[{label:d.formatMessage(l.Z.name).toLowerCase(),type:"text",filterValues:{key:"text-filter",onChange:(e,t)=>x({...N,offset:0,text:t}),value:N.text,placeholder:d.formatMessage(l.Z.filterByName)}},{label:d.formatMessage(l.Z.version),placeholder:d.formatMessage(l.Z.filterByVersion),type:A.conditionalFilterType.checkbox,filterValues:{id:"version-filter",key:"version-filter",onChange:(e,t)=>re("version",t),value:N.version,items:h()(O.filter((e=>void 0!==e.cluster_version&&""!==e.cluster_version)).map((e=>({label:e.cluster_version,value:(0,Z.WL)(e.cluster_version)}))).sort(((e,t)=>(0,Z._)((0,Z.WL)(e.cluster_version),(0,Z.WL)(t.cluster_version),1))).reverse(),"value")}},{label:T.RT.hits.title,type:T.RT.hits.type,id:T.RT.hits.urlParam,value:`checkbox-${T.RT.hits.urlParam}`,filterValues:{key:`${T.RT.hits.urlParam}-filter`,onChange:(e,t)=>re(T.RT.hits.urlParam,t),value:N.hits,items:T.RT.hits.values}}],ne={showDeleteButton:!0,deleteTitle:d.formatMessage(l.Z.resetFilters),filters:(0,Z.mt)(N,T.RT),onDelete:(e,t,r)=>{r?_()(N,I.Ly)?c():(0,I.aw)(N,I.Ly,x):t.map((e=>{const t={[e.urlParam]:Array.isArray(N[e.urlParam])?N[e.urlParam].filter((t=>String(t)!==String(e.chips[0].value))):""};var r;t[e.urlParam].length>0?x({...N,...t}):(r=e.urlParam,(0,Z.oo)(N,x,r))}))}};return a().createElement(a().Fragment,null,n&&0===O.length?a().createElement(M.ER,null):a().createElement("div",{id:"clusters-list-table","data-ouia-safe":!K},a().createElement(S(),{pagination:{itemCount:V.length,page:B,perPage:N.limit,onSetPage:(e,t)=>(H(!1),x({...N,offset:N.limit*(t-1)})),onPerPageSelect:(e,t)=>(H(!1),x({...N,limit:t,offset:0})),isCompact:!0,ouiaId:"pager"},filterConfig:{items:ie},activeFiltersConfig:ne}),a().createElement(b.i,{"aria-label":"Table of clusters",ouiaId:"clusters",ouiaSafe:!K,variant:y.B.compact,cells:T.Bg,rows:X||K||ee?[{fullWidth:!0,cells:[{props:{colSpan:T.Bg.length+1},title:X?a().createElement(M.Te,null):K?a().createElement(W.Z,null):a().createElement(M.VA,null)}]}]:Y?U:a().createElement(M.Te,null),sortBy:{index:N.sortIndex,direction:N.sortDirection},onSort:(e,t,r)=>{H(!1),x({...N,sortIndex:t,sortDirection:r})},isStickyHeader:!0},a().createElement(k.x,null),a().createElement(w.R,null)),a().createElement(P.Pagination,{ouiaId:"pager",itemCount:V.length,page:N.offset/N.limit+1,perPage:Number(N.limit),onSetPage:(e,t)=>x({...N,offset:N.limit*(t-1)}),onPerPageSelect:(e,t)=>x({...N,limit:t,offset:0}),widgetId:"pagination-options-menu-bottom",variant:E.aM.bottom})))};N.propTypes={query:u().object.isRequired};const O=()=>{const e=(0,o.Oj)();return a().createElement(N,{query:e})};var B=r(50318),V=r(55140);const F=()=>{const e=(0,i.Z)();return(0,V.Z)().updateDocumentTitle(e.formatMessage(l.Z.documentTitle,{subnav:e.formatMessage(l.Z.clusters)})),a().createElement(a().Fragment,null,a().createElement(n.Z,{className:"ins-c-clusters-header"},a().createElement(B.Title,{headingLevel:"h1",ouiaId:"page-header"},`${e.formatMessage(l.Z.insightsHeader)} ${e.formatMessage(l.Z.clusters).toLowerCase()}`)),a().createElement("section",{className:"pf-l-page__main-section pf-c-page__main-section"},a().createElement(O,null)))}},57642:(e,t,r)=>{"use strict";r.d(t,{Lg:()=>f,Lv:()=>y,U1:()=>b,WL:()=>g,_:()=>h,_F:()=>u,aM:()=>p,im:()=>m,mt:()=>d,oo:()=>v,yG:()=>_});var s=r(48403),a=r.n(s),i=r(50361),n=r.n(i),l=(r(28416),r(81249)),o=r(81563),c=r(94608);const u=(e,t)=>Object.entries(t).every((([t,r])=>{switch(t){case"text":return e.description.toLowerCase().includes(r.toLowerCase());case o.W2.total_risk.urlParam:return r.includes(String(e.total_risk));case o.W2.category.urlParam:return e.tags.find((e=>r.includes(String(o.kT[e]))));case o.W2.impact.urlParam:return r.includes(String(e.impact));case o.W2.impacting.urlParam:return!(r.length>0)||r.some((t=>"true"===t?e.impacted_clusters_count>0:"false"===t?0===e.impacted_clusters_count:void 0));case o.W2.likelihood.urlParam:return r.includes(String(e.likelihood));case o.W2.rule_status.urlParam:return"all"===r||"disabled"===r&&e.disabled||"enabled"===r&&!e.disabled;case o.W2.res_risk.urlParam:return r.includes(String(e.resolution_risk));default:return!0}})),m=(e,t)=>Object.entries(t).every((([t,r])=>{switch(t){case"text":return(e.cluster_name||e.cluster_id).toLowerCase().includes(r.toLowerCase());case o.RT.hits.urlParam:return 0===r.length&&parseInt(e.total_hit_count)>0||r.includes("all")||r.some((t=>e.hits_by_total_risk[t]>0));case"version":return 0===r.length||r.includes(g(e.cluster_version));default:return!0}})),d=(e,t)=>{const r=n()(e);return delete r.sortIndex,delete r.sortDirection,delete r.sort,delete r.offset,delete r.limit,r?.hits&&0===r.hits.length&&delete r.hits,((e,t)=>Object.entries(e||{}).reduce(((e,r)=>{const[s,i]=r;if(t[s]){const r=t[s],n=Array.isArray(i)?i.map((e=>{const t=r.values.find((t=>t.value===String(e)));return t?{name:t.text||t.label,value:e}:{name:e,value:e}})):[{name:r.values.find((e=>e.value===String(i))).label,value:i}];return[...e,{category:a()(r.title),chips:n,urlParam:r.urlParam}]}return"text"===s?[...e,...i.length>0?[{category:"Name",chips:[{name:i,value:i}],urlParam:s}]:[]]:"version"===s?[...e,...i.length>0?[{category:"Version",chips:i.map((e=>({name:e,value:e}))),urlParam:s}]:[]]:"namespace_name"===s?[...e,...i.length>0?[{category:"Namespace name",chips:[{name:i,value:i}],urlParam:s}]:[]]:"cluster_name"===s?[...e,...i.length>0?[{category:"Cluster name",chips:[{name:i,value:i}],urlParam:s}]:[]]:void 0}),[]))(r,t)},_=e=>{const t=new URLSearchParams(e);return Array.from(t).reduce(((e,[t,r])=>({...e,[t]:["text","first","rule_status","sort","cluster_name","namespace_name","description","object_id"].includes(t)?r:"true"===r||"false"===r?JSON.parse(r):r.split(",")})),{})},f=e=>({name:e.substring(e.startsWith("-")?1:0),direction:e.startsWith("-")?"desc":"asc",description:e.substring(e.startsWith("-")?1:0),object_id:e.substring(e.startsWith("-")?1:0)}),p=(e={},t)=>{const r=new URL(window.location.origin+window.location.pathname);var s,a,i;r.searchParams.set("sort",(s=e.sortIndex,a=t,i=e.sortDirection,["desc","asc"].includes(i)||console.error("Invalid sort parameters (is not asc nor desc)"),`${"asc"===i?"":"-"}${a[s]}`)),Object.entries(e).forEach((([e,t])=>"sortIndex"!==e&&"sortDirection"!==e&&"sort"!==e&&""!==t&&!(Array.isArray(t)&&0===t.length)&&r.searchParams.set(e,t))),window.history.replaceState(null,null,r.href)},h=(e,t,r)=>r*(0,l.compare)(e,t),g=e=>(0,l.coerce)(void 0!==e&&(0,l.valid)((0,l.coerce)(e))?e:"0.0.0").version,v=(e,t,r)=>{const{[r]:s,...a}={...e,offset:0};t({...a,..."text"===r?{text:""}:"hits"===r?{hits:[]}:"version"===r?{version:[]}:"object_id"===r?{object_id:""}:{}})},y=(e,t,r,s)=>s.length>0?t({...e,offset:0,[r]:s}):v(e,t,r),b=(e,t)=>{const r=(0,c.Vs)(e.metadata.hits_by_severity,"general");return Object.entries(t).every((([s,a])=>{switch(s){case"cluster_name":return(e.cluster.display_name||e.cluster.uuid).toLowerCase().includes(a.toLowerCase());case"namespace_name":return(e.namespace.name||e.namespace.uuid).toLowerCase().includes(a.toLowerCase());case"severity":return 0===a.length||(0,c.mR)(r,t.severity);default:return!0}}))}},83920:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(28416),a=r.n(s),i=r(67073),n=r(24561);const l=()=>a().createElement(i.Card,{ouiaId:"loading-skeleton"},a().createElement(i.CardBody,null,a().createElement(n.aV,null)))},94608:(e,t,r)=>{"use strict";r.d(t,{Q$:()=>y,Vs:()=>u,ke:()=>g,l8:()=>v,lM:()=>p,mR:()=>m,p5:()=>b,sI:()=>k,wW:()=>d,y4:()=>w});var s=r(48585),a=r(14176),i=r.n(a),n=r(50361),l=r.n(n),o=r(41609),c=r.n(o);const u=(e,t)=>{const r={1:"low",2:"moderate",3:"important",4:"critical"};let s={};if("general"===t||"label"===t)for(const t in e)t in r&&(s[r[t]]=e[t]);else s=r[e];return s},m=(e,t)=>{for(const r of t)if(e[r]>0)return!0},d=e=>{const t=l()(e);return delete t.sortIndex,delete t.sortDirection,delete t.offset,delete t.limit,delete t.sort,!!Object.values(t).filter((e=>!c()(e))).length},_=e=>e?.charAt(0).toUpperCase()+e?.slice(1),f=(e,t)=>{if(e.values){const r=e.values.find((e=>e.value===String(t)));return r?{name:r.label||r.text,value:t}:{name:t,value:t}}return{name:t,value:t}},p=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>{if(t[r]){const a=t[r];if(Array.isArray(s)&&s.length>0||"string"==typeof s&&""!==s.trim()){const t=Array.isArray(s)?s.map((e=>f(a,e))):[f(a,s)];e.push({category:_(a.label),chips:t,urlParam:a.urlParam})}}else"display_name"===r&&""!==s.trim()?e.push({category:_(r.replace("display_name","Name")),chips:[{name:s,value:s}],urlParam:"display_name"}):"description"!==r&&"object_id"!==r||""===s.trim()||e.push({category:_(r.replace("_"," ")),chips:[{name:s,value:s}],urlParam:r});return e}),[]),h=(e,t)=>{const r=t[0].rule;switch(e){case 1:return r.details;case 2:return r.total_risk;case 3:return r.objects.length;case 4:return r.modified}},g=(e,t,r)=>e>=1?[...r]?.sort(((r,a)=>{const i=t===s.B.asc?1:-1;return h(e,r)>h(e,a)?i:h(e,a)>h(e,r)?-i:0})):[...r],v=(e,t)=>e.flatMap(((e,r)=>{const s=[...e];return t&&0===r&&(e[0].isOpen=!0),e[1].parent=2*r,s})),y=(e,t)=>{const r=i()(l()(t),c());return Object.entries(r).every((([t,r])=>{switch(t){case"display_name":return r&&e?.display_name?.toLowerCase().includes(r.toLowerCase());case"object_id":return r&&e?.uid?.toLowerCase().includes(r.toLowerCase());default:return!0}}))},b=(e,t,r)=>{const{[r]:s,...a}={...e};t({...a,..."description"===r?{description:""}:"total_risk"===r?{total_risk:[]}:"object_id"===r?{object_id:""}:{}})},k=(e,t,r,s)=>s.length>0?t({...e,[r]:s}):b(e,t,r),w=(e,t)=>{const r=i()(l()(t),c());return Object.entries(r).every((([t,r])=>{switch(t){case"description":return r&&e.details.toLowerCase().includes(r.toLowerCase());case"object_id":return r&&e.objects.some((e=>e.uid.toLowerCase().includes(r.toLowerCase())));case"total_risk":return r&&r.includes(String(e.total_risk));default:return!0}}))}},65088:()=>{},36150:()=>{},63498:()=>{},36213:()=>{},81235:()=>{},81754:()=>{},16506:()=>{},43109:()=>{},70347:()=>{},12796:()=>{},95594:()=>{},15622:()=>{},58392:()=>{},10497:()=>{},80598:()=>{},32857:()=>{},1580:()=>{},94498:()=>{},37625:()=>{},71644:()=>{},23055:()=>{},54476:()=>{},27567:()=>{},28992:()=>{},90146:()=>{},80897:()=>{},30187:()=>{},40837:()=>{},50311:()=>{},90479:()=>{},78752:()=>{},71338:()=>{},11080:()=>{},44839:()=>{},21626:()=>{},74282:()=>{},67274:()=>{},24620:()=>{},82014:()=>{},90776:()=>{},88277:()=>{},97939:()=>{},8572:()=>{},98379:()=>{},25238:()=>{},61612:()=>{},33858:()=>{},66213:()=>{},77350:()=>{},69076:()=>{},70150:()=>{},92084:()=>{},46928:()=>{},1508:()=>{},91993:()=>{},84958:()=>{},37739:()=>{},99624:()=>{},36974:()=>{},43919:()=>{},91027:()=>{},53336:()=>{},16061:()=>{},27479:()=>{},93661:()=>{},56024:()=>{},54994:()=>{},44690:()=>{},37494:()=>{},43390:()=>{},22143:()=>{},48223:()=>{},7064:()=>{},97853:()=>{},97236:()=>{},38024:()=>{},11489:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},51934:()=>{},72816:()=>{},74181:()=>{},16166:()=>{}}]);
//# sourceMappingURL=../sourcemaps/ClustersList.f35755e2ede0416566f2ad18a2001976.js.map